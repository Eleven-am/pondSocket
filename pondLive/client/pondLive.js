"use strict";(()=>{var Ir=Object.create;var Ie=Object.defineProperty,Nr=Object.defineProperties,Wr=Object.getOwnPropertyDescriptor,Hr=Object.getOwnPropertyDescriptors,Ur=Object.getOwnPropertyNames,lt=Object.getOwnPropertySymbols,jr=Object.getPrototypeOf,mt=Object.prototype.hasOwnProperty,Br=Object.prototype.propertyIsEnumerable;var pt=(r,t,e)=>t in r?Ie(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Ne=(r,t)=>{for(var e in t||(t={}))mt.call(t,e)&&pt(r,e,t[e]);if(lt)for(var e of lt(t))Br.call(t,e)&&pt(r,e,t[e]);return r},We=(r,t)=>Nr(r,Hr(t));var Vr=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var Gr=(r,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ur(t))!mt.call(r,n)&&n!==e&&Ie(r,n,{get:()=>t[n],enumerable:!(o=Wr(t,n))||o.enumerable});return r};var qr=(r,t,e)=>(e=r!=null?Ir(jr(r)):{},Gr(t||!r||!r.__esModule?Ie(e,"default",{value:r,enumerable:!0}):e,r));var Rt=Vr(($o,te)=>{var dt,ht,vt,bt,yt,xt,gt,_t,St,Z,He,Et,wt,Tt,H,At,Pt,Dt,Ot,Mt,Ct,kt,Lt,Ft,ee;(function(r){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(o){r(e(t,e(o)))}):typeof te=="object"&&typeof te.exports=="object"?r(e(t,e(te.exports))):r(e(t));function e(o,n){return o!==t&&(typeof Object.create=="function"?Object.defineProperty(o,"__esModule",{value:!0}):o.__esModule=!0),function(i,s){return o[i]=n?n(i,s):s}}})(function(r){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,n){o.__proto__=n}||function(o,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(o[i]=n[i])};dt=function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(o,n);function i(){this.constructor=o}o.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)},ht=Object.assign||function(o){for(var n,i=1,s=arguments.length;i<s;i++){n=arguments[i];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(o[a]=n[a])}return o},vt=function(o,n){var i={};for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&n.indexOf(s)<0&&(i[s]=o[s]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(o);a<s.length;a++)n.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(o,s[a])&&(i[s[a]]=o[s[a]]);return i},bt=function(o,n,i,s){var a=arguments.length,c=a<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,i):s,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,n,i,s);else for(var f=o.length-1;f>=0;f--)(u=o[f])&&(c=(a<3?u(c):a>3?u(n,i,c):u(n,i))||c);return a>3&&c&&Object.defineProperty(n,i,c),c},yt=function(o,n){return function(i,s){n(i,s,o)}},xt=function(o,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,n)},gt=function(o,n,i,s){function a(c){return c instanceof i?c:new i(function(u){u(c)})}return new(i||(i=Promise))(function(c,u){function f(d){try{l(s.next(d))}catch(_){u(_)}}function m(d){try{l(s.throw(d))}catch(_){u(_)}}function l(d){d.done?c(d.value):a(d.value).then(f,m)}l((s=s.apply(o,n||[])).next())})},_t=function(o,n){var i={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},s,a,c,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(l){return function(d){return m([l,d])}}function m(l){if(s)throw new TypeError("Generator is already executing.");for(;i;)try{if(s=1,a&&(c=l[0]&2?a.return:l[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,l[1])).done)return c;switch(a=0,c&&(l=[l[0]&2,c.value]),l[0]){case 0:case 1:c=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,a=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(c=i.trys,!(c=c.length>0&&c[c.length-1])&&(l[0]===6||l[0]===2)){i=0;continue}if(l[0]===3&&(!c||l[1]>c[0]&&l[1]<c[3])){i.label=l[1];break}if(l[0]===6&&i.label<c[1]){i.label=c[1],c=l;break}if(c&&i.label<c[2]){i.label=c[2],i.ops.push(l);break}c[2]&&i.ops.pop(),i.trys.pop();continue}l=n.call(o,i)}catch(d){l=[6,d],a=0}finally{s=c=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},St=function(o,n){for(var i in o)i!=="default"&&!Object.prototype.hasOwnProperty.call(n,i)&&ee(n,o,i)},ee=Object.create?function(o,n,i,s){s===void 0&&(s=i);var a=Object.getOwnPropertyDescriptor(n,i);(!a||("get"in a?!n.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return n[i]}}),Object.defineProperty(o,s,a)}:function(o,n,i,s){s===void 0&&(s=i),o[s]=n[i]},Z=function(o){var n=typeof Symbol=="function"&&Symbol.iterator,i=n&&o[n],s=0;if(i)return i.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&s>=o.length&&(o=void 0),{value:o&&o[s++],done:!o}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},He=function(o,n){var i=typeof Symbol=="function"&&o[Symbol.iterator];if(!i)return o;var s=i.call(o),a,c=[],u;try{for(;(n===void 0||n-- >0)&&!(a=s.next()).done;)c.push(a.value)}catch(f){u={error:f}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(u)throw u.error}}return c},Et=function(){for(var o=[],n=0;n<arguments.length;n++)o=o.concat(He(arguments[n]));return o},wt=function(){for(var o=0,n=0,i=arguments.length;n<i;n++)o+=arguments[n].length;for(var s=Array(o),a=0,n=0;n<i;n++)for(var c=arguments[n],u=0,f=c.length;u<f;u++,a++)s[a]=c[u];return s},Tt=function(o,n,i){if(i||arguments.length===2)for(var s=0,a=n.length,c;s<a;s++)(c||!(s in n))&&(c||(c=Array.prototype.slice.call(n,0,s)),c[s]=n[s]);return o.concat(c||Array.prototype.slice.call(n))},H=function(o){return this instanceof H?(this.v=o,this):new H(o)},At=function(o,n,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=i.apply(o,n||[]),a,c=[];return a={},u("next"),u("throw"),u("return"),a[Symbol.asyncIterator]=function(){return this},a;function u(p){s[p]&&(a[p]=function(S){return new Promise(function(A,W){c.push([p,S,A,W])>1||f(p,S)})})}function f(p,S){try{m(s[p](S))}catch(A){_(c[0][3],A)}}function m(p){p.value instanceof H?Promise.resolve(p.value.v).then(l,d):_(c[0][2],p)}function l(p){f("next",p)}function d(p){f("throw",p)}function _(p,S){p(S),c.shift(),c.length&&f(c[0][0],c[0][1])}},Pt=function(o){var n,i;return n={},s("next"),s("throw",function(a){throw a}),s("return"),n[Symbol.iterator]=function(){return this},n;function s(a,c){n[a]=o[a]?function(u){return(i=!i)?{value:H(o[a](u)),done:a==="return"}:c?c(u):u}:c}},Dt=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=o[Symbol.asyncIterator],i;return n?n.call(o):(o=typeof Z=="function"?Z(o):o[Symbol.iterator](),i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i);function s(c){i[c]=o[c]&&function(u){return new Promise(function(f,m){u=o[c](u),a(f,m,u.done,u.value)})}}function a(c,u,f,m){Promise.resolve(m).then(function(l){c({value:l,done:f})},u)}},Ot=function(o,n){return Object.defineProperty?Object.defineProperty(o,"raw",{value:n}):o.raw=n,o};var e=Object.create?function(o,n){Object.defineProperty(o,"default",{enumerable:!0,value:n})}:function(o,n){o.default=n};Mt=function(o){if(o&&o.__esModule)return o;var n={};if(o!=null)for(var i in o)i!=="default"&&Object.prototype.hasOwnProperty.call(o,i)&&ee(n,o,i);return e(n,o),n},Ct=function(o){return o&&o.__esModule?o:{default:o}},kt=function(o,n,i,s){if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof n=="function"?o!==n||!s:!n.has(o))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?s:i==="a"?s.call(o):s?s.value:n.get(o)},Lt=function(o,n,i,s,a){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof n=="function"?o!==n||!a:!n.has(o))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?a.call(o,i):a?a.value=i:n.set(o,i),i},Ft=function(o,n){if(n===null||typeof n!="object"&&typeof n!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof o=="function"?n===o:o.has(n)},r("__extends",dt),r("__assign",ht),r("__rest",vt),r("__decorate",bt),r("__param",yt),r("__metadata",xt),r("__awaiter",gt),r("__generator",_t),r("__exportStar",St),r("__createBinding",ee),r("__values",Z),r("__read",He),r("__spread",Et),r("__spreadArrays",wt),r("__spreadArray",Tt),r("__await",H),r("__asyncGenerator",At),r("__asyncDelegator",Pt),r("__asyncValues",Dt),r("__makeTemplateObject",Ot),r("__importStar",Mt),r("__importDefault",Ct),r("__classPrivateFieldGet",kt),r("__classPrivateFieldSet",Lt),r("__classPrivateFieldIn",Ft)})});var It=qr(Rt(),1),{__extends:g,__assign:Nt,__rest:Ko,__decorate:Yo,__param:Jo,__metadata:Xo,__awaiter:Wt,__generator:re,__exportStar:Qo,__createBinding:Zo,__values:F,__read:P,__spread:en,__spreadArrays:tn,__spreadArray:D,__await:oe,__asyncGenerator:Ht,__asyncDelegator:rn,__asyncValues:Ut,__makeTemplateObject:on,__importStar:nn,__importDefault:sn,__classPrivateFieldGet:an,__classPrivateFieldSet:cn,__classPrivateFieldIn:un}=It.default;function h(r){return typeof r=="function"}function ne(r){var t=function(o){Error.call(o),o.stack=new Error().stack},e=r(t);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var ie=ne(function(r){return function(e){r(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(o,n){return n+1+") "+o.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function R(r,t){if(r){var e=r.indexOf(t);0<=e&&r.splice(e,1)}}var M=function(){function r(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var t,e,o,n,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=F(s),c=a.next();!c.done;c=a.next()){var u=c.value;u.remove(this)}}catch(p){t={error:p}}finally{try{c&&!c.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}else s.remove(this);var f=this.initialTeardown;if(h(f))try{f()}catch(p){i=p instanceof ie?p.errors:[p]}var m=this._finalizers;if(m){this._finalizers=null;try{for(var l=F(m),d=l.next();!d.done;d=l.next()){var _=d.value;try{jt(_)}catch(p){i=i!=null?i:[],p instanceof ie?i=D(D([],P(i)),P(p.errors)):i.push(p)}}}catch(p){o={error:p}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(o)throw o.error}}}if(i)throw new ie(i)}},r.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)jt(t);else{if(t instanceof r){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}},r.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},r.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},r.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&R(e,t)},r.prototype.remove=function(t){var e=this._finalizers;e&&R(e,t),t instanceof r&&t._removeParent(this)},r.EMPTY=function(){var t=new r;return t.closed=!0,t}(),r}();var Ue=M.EMPTY;function se(r){return r instanceof M||r&&"closed"in r&&h(r.remove)&&h(r.add)&&h(r.unsubscribe)}function jt(r){h(r)?r():r.unsubscribe()}var O={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var U={setTimeout:function(r,t){for(var e=[],o=2;o<arguments.length;o++)e[o-2]=arguments[o];var n=U.delegate;return n!=null&&n.setTimeout?n.setTimeout.apply(n,D([r,t],P(e))):setTimeout.apply(void 0,D([r,t],P(e)))},clearTimeout:function(r){var t=U.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(r)},delegate:void 0};function ae(r){U.setTimeout(function(){var t=O.onUnhandledError;if(t)t(r);else throw r})}function V(){}var Bt=function(){return je("C",void 0,void 0)}();function Vt(r){return je("E",void 0,r)}function Gt(r){return je("N",r,void 0)}function je(r,t,e){return{kind:r,value:t,error:e}}var I=null;function j(r){if(O.useDeprecatedSynchronousErrorHandling){var t=!I;if(t&&(I={errorThrown:!1,error:null}),r(),t){var e=I,o=e.errorThrown,n=e.error;if(I=null,o)throw n}}else r()}function qt(r){O.useDeprecatedSynchronousErrorHandling&&I&&(I.errorThrown=!0,I.error=r)}var N=function(r){g(t,r);function t(e){var o=r.call(this)||this;return o.isStopped=!1,e?(o.destination=e,se(e)&&e.add(o)):o.destination=Yr,o}return t.create=function(e,o,n){return new ue(e,o,n)},t.prototype.next=function(e){this.isStopped?Ve(Gt(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Ve(Vt(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Ve(Bt,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(M);var zr=Function.prototype.bind;function Be(r,t){return zr.call(r,t)}var $r=function(){function r(t){this.partialObserver=t}return r.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(o){ce(o)}},r.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(o){ce(o)}else ce(t)},r.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){ce(e)}},r}(),ue=function(r){g(t,r);function t(e,o,n){var i=r.call(this)||this,s;if(h(e)||!e)s={next:e!=null?e:void 0,error:o!=null?o:void 0,complete:n!=null?n:void 0};else{var a;i&&O.useDeprecatedNextContext?(a=Object.create(e),a.unsubscribe=function(){return i.unsubscribe()},s={next:e.next&&Be(e.next,a),error:e.error&&Be(e.error,a),complete:e.complete&&Be(e.complete,a)}):s=e}return i.destination=new $r(s),i}return t}(N);function ce(r){O.useDeprecatedSynchronousErrorHandling?qt(r):ae(r)}function Kr(r){throw r}function Ve(r,t){var e=O.onStoppedNotification;e&&U.setTimeout(function(){return e(r,t)})}var Yr={closed:!0,next:V,error:Kr,complete:V};var B=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function fe(r){return r}function Ge(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return qe(r)}function qe(r){return r.length===0?fe:r.length===1?r[0]:function(e){return r.reduce(function(o,n){return n(o)},e)}}var v=function(){function r(t){t&&(this._subscribe=t)}return r.prototype.lift=function(t){var e=new r;return e.source=this,e.operator=t,e},r.prototype.subscribe=function(t,e,o){var n=this,i=Xr(t)?t:new ue(t,e,o);return j(function(){var s=n,a=s.operator,c=s.source;i.add(a?a.call(i,c):c?n._subscribe(i):n._trySubscribe(i))}),i},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},r.prototype.forEach=function(t,e){var o=this;return e=zt(e),new e(function(n,i){var s=new ue({next:function(a){try{t(a)}catch(c){i(c),s.unsubscribe()}},error:i,complete:n});o.subscribe(s)})},r.prototype._subscribe=function(t){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(t)},r.prototype[B]=function(){return this},r.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return qe(t)(this)},r.prototype.toPromise=function(t){var e=this;return t=zt(t),new t(function(o,n){var i;e.subscribe(function(s){return i=s},function(s){return n(s)},function(){return o(i)})})},r.create=function(t){return new r(t)},r}();function zt(r){var t;return(t=r!=null?r:O.Promise)!==null&&t!==void 0?t:Promise}function Jr(r){return r&&h(r.next)&&h(r.error)&&h(r.complete)}function Xr(r){return r&&r instanceof N||Jr(r)&&se(r)}var $t=ne(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var w=function(r){g(t,r);function t(){var e=r.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype.lift=function(e){var o=new le(this,this);return o.operator=e,o},t.prototype._throwIfClosed=function(){if(this.closed)throw new $t},t.prototype.next=function(e){var o=this;j(function(){var n,i;if(o._throwIfClosed(),!o.isStopped){o.currentObservers||(o.currentObservers=Array.from(o.observers));try{for(var s=F(o.currentObservers),a=s.next();!a.done;a=s.next()){var c=a.value;c.next(e)}}catch(u){n={error:u}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var o=this;j(function(){if(o._throwIfClosed(),!o.isStopped){o.hasError=o.isStopped=!0,o.thrownError=e;for(var n=o.observers;n.length;)n.shift().error(e)}})},t.prototype.complete=function(){var e=this;j(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var o=e.observers;o.length;)o.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(e){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var o=this,n=this,i=n.hasError,s=n.isStopped,a=n.observers;return i||s?Ue:(this.currentObservers=null,a.push(e),new M(function(){o.currentObservers=null,R(a,e)}))},t.prototype._checkFinalizedStatuses=function(e){var o=this,n=o.hasError,i=o.thrownError,s=o.isStopped;n?e.error(i):s&&e.complete()},t.prototype.asObservable=function(){var e=new v;return e.source=this,e},t.create=function(e,o){return new le(e,o)},t}(v);var le=function(r){g(t,r);function t(e,o){var n=r.call(this)||this;return n.destination=e,n.source=o,n}return t.prototype.next=function(e){var o,n;(n=(o=this.destination)===null||o===void 0?void 0:o.next)===null||n===void 0||n.call(o,e)},t.prototype.error=function(e){var o,n;(n=(o=this.destination)===null||o===void 0?void 0:o.error)===null||n===void 0||n.call(o,e)},t.prototype.complete=function(){var e,o;(o=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||o===void 0||o.call(e)},t.prototype._subscribe=function(e){var o,n;return(n=(o=this.source)===null||o===void 0?void 0:o.subscribe(e))!==null&&n!==void 0?n:Ue},t}(w);var G={now:function(){return(G.delegate||Date).now()},delegate:void 0};var pe=function(r){g(t,r);function t(e,o,n){e===void 0&&(e=1/0),o===void 0&&(o=1/0),n===void 0&&(n=G);var i=r.call(this)||this;return i._bufferSize=e,i._windowTime=o,i._timestampProvider=n,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=o===1/0,i._bufferSize=Math.max(1,e),i._windowTime=Math.max(1,o),i}return t.prototype.next=function(e){var o=this,n=o.isStopped,i=o._buffer,s=o._infiniteTimeWindow,a=o._timestampProvider,c=o._windowTime;n||(i.push(e),!s&&i.push(a.now()+c)),this._trimBuffer(),r.prototype.next.call(this,e)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var o=this._innerSubscribe(e),n=this,i=n._infiniteTimeWindow,s=n._buffer,a=s.slice(),c=0;c<a.length&&!e.closed;c+=i?1:2)e.next(a[c]);return this._checkFinalizedStatuses(e),o},t.prototype._trimBuffer=function(){var e=this,o=e._bufferSize,n=e._timestampProvider,i=e._buffer,s=e._infiniteTimeWindow,a=(s?1:2)*o;if(o<1/0&&a<i.length&&i.splice(0,i.length-a),!s){for(var c=n.now(),u=0,f=1;f<i.length&&i[f]<=c;f+=2)u=f;u&&i.splice(0,u+1)}},t}(w);var Qr={url:"",deserializer:function(r){return JSON.parse(r.data)},serializer:function(r){return JSON.stringify(r)}},Zr="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",Kt=function(r){g(t,r);function t(e,o){var n=r.call(this)||this;if(n._socket=null,e instanceof v)n.destination=o,n.source=e;else{var i=n._config=Nt({},Qr);if(n._output=new w,typeof e=="string")i.url=e;else for(var s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);if(!i.WebSocketCtor&&WebSocket)i.WebSocketCtor=WebSocket;else if(!i.WebSocketCtor)throw new Error("no WebSocket constructor can be found");n.destination=new pe}return n}return t.prototype.lift=function(e){var o=new t(this._config,this.destination);return o.operator=e,o.source=this,o},t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new pe),this._output=new w},t.prototype.multiplex=function(e,o,n){var i=this;return new v(function(s){try{i.next(e())}catch(c){s.error(c)}var a=i.subscribe({next:function(c){try{n(c)&&s.next(c)}catch(u){s.error(u)}},error:function(c){return s.error(c)},complete:function(){return s.complete()}});return function(){try{i.next(o())}catch(c){s.error(c)}a.unsubscribe()}})},t.prototype._connectSocket=function(){var e=this,o=this._config,n=o.WebSocketCtor,i=o.protocol,s=o.url,a=o.binaryType,c=this._output,u=null;try{u=i?new n(s,i):new n(s),this._socket=u,a&&(this._socket.binaryType=a)}catch(m){c.error(m);return}var f=new M(function(){e._socket=null,u&&u.readyState===1&&u.close()});u.onopen=function(m){var l=e._socket;if(!l){u.close(),e._resetState();return}var d=e._config.openObserver;d&&d.next(m);var _=e.destination;e.destination=N.create(function(p){if(u.readyState===1)try{var S=e._config.serializer;u.send(S(p))}catch(A){e.destination.error(A)}},function(p){var S=e._config.closingObserver;S&&S.next(void 0),p&&p.code?u.close(p.code,p.reason):c.error(new TypeError(Zr)),e._resetState()},function(){var p=e._config.closingObserver;p&&p.next(void 0),u.close(),e._resetState()}),_&&_ instanceof pe&&f.add(_.subscribe(e.destination))},u.onerror=function(m){e._resetState(),c.error(m)},u.onclose=function(m){u===e._socket&&e._resetState();var l=e._config.closeObserver;l&&l.next(m),m.wasClean?c.complete():c.error(m)},u.onmessage=function(m){try{var l=e._config.deserializer;c.next(l(m))}catch(d){c.error(d)}}},t.prototype._subscribe=function(e){var o=this,n=this.source;return n?n.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add(function(){var i=o._socket;o._output.observers.length===0&&(i&&(i.readyState===1||i.readyState===0)&&i.close(),o._resetState())}),e)},t.prototype.unsubscribe=function(){var e=this._socket;e&&(e.readyState===1||e.readyState===0)&&e.close(),this._resetState(),r.prototype.unsubscribe.call(this)},t}(le);function ze(r){return new Kt(r)}function eo(r){return h(r==null?void 0:r.lift)}function y(r){return function(t){if(eo(t))return t.lift(function(e){try{return r(e,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function b(r,t,e,o,n){return new to(r,t,e,o,n)}var to=function(r){g(t,r);function t(e,o,n,i,s,a){var c=r.call(this,e)||this;return c.onFinalize=s,c.shouldUnsubscribe=a,c._next=o?function(u){try{o(u)}catch(f){e.error(f)}}:r.prototype._next,c._error=i?function(u){try{i(u)}catch(f){e.error(f)}finally{this.unsubscribe()}}:r.prototype._error,c._complete=n?function(){try{n()}catch(u){e.error(u)}finally{this.unsubscribe()}}:r.prototype._complete,c}return t.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var o=this.closed;r.prototype.unsubscribe.call(this),!o&&((e=this.onFinalize)===null||e===void 0||e.call(this))}},t}(N);var Yt=function(r){g(t,r);function t(e,o){return r.call(this)||this}return t.prototype.schedule=function(e,o){return o===void 0&&(o=0),this},t}(M);var q={setInterval:function(r,t){for(var e=[],o=2;o<arguments.length;o++)e[o-2]=arguments[o];var n=q.delegate;return n!=null&&n.setInterval?n.setInterval.apply(n,D([r,t],P(e))):setInterval.apply(void 0,D([r,t],P(e)))},clearInterval:function(r){var t=q.delegate;return((t==null?void 0:t.clearInterval)||clearInterval)(r)},delegate:void 0};var Jt=function(r){g(t,r);function t(e,o){var n=r.call(this,e,o)||this;return n.scheduler=e,n.work=o,n.pending=!1,n}return t.prototype.schedule=function(e,o){if(o===void 0&&(o=0),this.closed)return this;this.state=e;var n=this.id,i=this.scheduler;return n!=null&&(this.id=this.recycleAsyncId(i,n,o)),this.pending=!0,this.delay=o,this.id=this.id||this.requestAsyncId(i,this.id,o),this},t.prototype.requestAsyncId=function(e,o,n){return n===void 0&&(n=0),q.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,o,n){if(n===void 0&&(n=0),n!=null&&this.delay===n&&this.pending===!1)return o;q.clearInterval(o)},t.prototype.execute=function(e,o){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,o);if(n)return n;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,o){var n=!1,i;try{this.work(e)}catch(s){n=!0,i=s||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),i},t.prototype.unsubscribe=function(){if(!this.closed){var e=this,o=e.id,n=e.scheduler,i=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,R(i,this),o!=null&&(this.id=this.recycleAsyncId(n,o,null)),this.delay=null,r.prototype.unsubscribe.call(this)}},t}(Yt);var $e=function(){function r(t,e){e===void 0&&(e=r.now),this.schedulerActionCtor=t,this.now=e}return r.prototype.schedule=function(t,e,o){return e===void 0&&(e=0),new this.schedulerActionCtor(this,t).schedule(o,e)},r.now=G.now,r}();var Xt=function(r){g(t,r);function t(e,o){o===void 0&&(o=$e.now);var n=r.call(this,e,o)||this;return n.actions=[],n._active=!1,n._scheduled=void 0,n}return t.prototype.flush=function(e){var o=this.actions;if(this._active){o.push(e);return}var n;this._active=!0;do if(n=e.execute(e.state,e.delay))break;while(e=o.shift());if(this._active=!1,n){for(;e=o.shift();)e.unsubscribe();throw n}},t}($e);var Ke=new Xt(Jt),Qt=Ke;var k=new v(function(r){return r.complete()});function me(r){return r&&h(r.schedule)}function Zt(r){return r[r.length-1]}function er(r){return h(Zt(r))?r.pop():void 0}function de(r){return me(Zt(r))?r.pop():void 0}var he=function(r){return r&&typeof r.length=="number"&&typeof r!="function"};function ve(r){return h(r==null?void 0:r.then)}function be(r){return h(r[B])}function ye(r){return Symbol.asyncIterator&&h(r==null?void 0:r[Symbol.asyncIterator])}function xe(r){return new TypeError("You provided "+(r!==null&&typeof r=="object"?"an invalid object":"'"+r+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function ro(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ge=ro();function _e(r){return h(r==null?void 0:r[ge])}function Se(r){return Ht(this,arguments,function(){var e,o,n,i;return re(this,function(s){switch(s.label){case 0:e=r.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,oe(e.read())];case 3:return o=s.sent(),n=o.value,i=o.done,i?[4,oe(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,oe(n)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function Ee(r){return h(r==null?void 0:r.getReader)}function E(r){if(r instanceof v)return r;if(r!=null){if(be(r))return oo(r);if(he(r))return no(r);if(ve(r))return io(r);if(ye(r))return tr(r);if(_e(r))return so(r);if(Ee(r))return ao(r)}throw xe(r)}function oo(r){return new v(function(t){var e=r[B]();if(h(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function no(r){return new v(function(t){for(var e=0;e<r.length&&!t.closed;e++)t.next(r[e]);t.complete()})}function io(r){return new v(function(t){r.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,ae)})}function so(r){return new v(function(t){var e,o;try{for(var n=F(r),i=n.next();!i.done;i=n.next()){var s=i.value;if(t.next(s),t.closed)return}}catch(a){e={error:a}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(e)throw e.error}}t.complete()})}function tr(r){return new v(function(t){co(r,t).catch(function(e){return t.error(e)})})}function ao(r){return tr(Se(r))}function co(r,t){var e,o,n,i;return Wt(this,void 0,void 0,function(){var s,a;return re(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),e=Ut(r),c.label=1;case 1:return[4,e.next()];case 2:if(o=c.sent(),!!o.done)return[3,4];if(s=o.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),n={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),o&&!o.done&&(i=e.return)?[4,i.call(e)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(n)throw n.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function T(r,t,e,o,n){o===void 0&&(o=0),n===void 0&&(n=!1);var i=t.schedule(function(){e(),n?r.add(this.schedule(null,o)):this.unsubscribe()},o);if(r.add(i),!n)return i}function we(r,t){return t===void 0&&(t=0),y(function(e,o){e.subscribe(b(o,function(n){return T(o,r,function(){return o.next(n)},t)},function(){return T(o,r,function(){return o.complete()},t)},function(n){return T(o,r,function(){return o.error(n)},t)}))})}function Te(r,t){return t===void 0&&(t=0),y(function(e,o){o.add(r.schedule(function(){return e.subscribe(o)},t))})}function rr(r,t){return E(r).pipe(Te(t),we(t))}function or(r,t){return E(r).pipe(Te(t),we(t))}function nr(r,t){return new v(function(e){var o=0;return t.schedule(function(){o===r.length?e.complete():(e.next(r[o++]),e.closed||this.schedule())})})}function ir(r,t){return new v(function(e){var o;return T(e,t,function(){o=r[ge](),T(e,t,function(){var n,i,s;try{n=o.next(),i=n.value,s=n.done}catch(a){e.error(a);return}s?e.complete():e.next(i)},0,!0)}),function(){return h(o==null?void 0:o.return)&&o.return()}})}function Ae(r,t){if(!r)throw new Error("Iterable cannot be null");return new v(function(e){T(e,t,function(){var o=r[Symbol.asyncIterator]();T(e,t,function(){o.next().then(function(n){n.done?e.complete():e.next(n.value)})},0,!0)})})}function sr(r,t){return Ae(Se(r),t)}function ar(r,t){if(r!=null){if(be(r))return rr(r,t);if(he(r))return nr(r,t);if(ve(r))return or(r,t);if(ye(r))return Ae(r,t);if(_e(r))return ir(r,t);if(Ee(r))return sr(r,t)}throw xe(r)}function Pe(r,t){return t?ar(r,t):E(r)}function cr(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=de(r);return Pe(r,e)}function z(r,t){var e=h(r)?r:function(){return r},o=function(n){return n.error(e())};return new v(t?function(n){return t.schedule(o,0,n)}:o)}var ur;(function(r){r.NEXT="N",r.ERROR="E",r.COMPLETE="C"})(ur||(ur={}));var De=function(){function r(t,e,o){this.kind=t,this.value=e,this.error=o,this.hasValue=t==="N"}return r.prototype.observe=function(t){return Ye(this,t)},r.prototype.do=function(t,e,o){var n=this,i=n.kind,s=n.value,a=n.error;return i==="N"?t==null?void 0:t(s):i==="E"?e==null?void 0:e(a):o==null?void 0:o()},r.prototype.accept=function(t,e,o){var n;return h((n=t)===null||n===void 0?void 0:n.next)?this.observe(t):this.do(t,e,o)},r.prototype.toObservable=function(){var t=this,e=t.kind,o=t.value,n=t.error,i=e==="N"?cr(o):e==="E"?z(function(){return n}):e==="C"?k:0;if(!i)throw new TypeError("Unexpected notification kind "+e);return i},r.createNext=function(t){return new r("N",t)},r.createError=function(t){return new r("E",void 0,t)},r.createComplete=function(){return r.completeNotification},r.completeNotification=new r("C"),r}();function Ye(r,t){var e,o,n,i=r,s=i.kind,a=i.value,c=i.error;if(typeof s!="string")throw new TypeError('Invalid notification, missing "kind"');s==="N"?(e=t.next)===null||e===void 0||e.call(t,a):s==="E"?(o=t.error)===null||o===void 0||o.call(t,c):(n=t.complete)===null||n===void 0||n.call(t)}function fr(r){return r instanceof Date&&!isNaN(r)}function L(r,t){return y(function(e,o){var n=0;e.subscribe(b(o,function(i){o.next(r.call(t,i,n++))}))})}function lr(r,t,e,o,n,i,s,a){var c=[],u=0,f=0,m=!1,l=function(){m&&!c.length&&!u&&t.complete()},d=function(p){return u<o?_(p):c.push(p)},_=function(p){i&&t.next(p),u++;var S=!1;E(e(p,f++)).subscribe(b(t,function(A){n==null||n(A),i?d(A):t.next(A)},function(){S=!0},void 0,function(){if(S)try{u--;for(var A=function(){var W=c.shift();s?T(t,s,function(){return _(W)}):_(W)};c.length&&u<o;)A();l()}catch(W){t.error(W)}}))};return r.subscribe(b(t,d,function(){m=!0,l()})),function(){a==null||a()}}function $(r,t,e){return e===void 0&&(e=1/0),h(t)?$(function(o,n){return L(function(i,s){return t(o,i,n,s)})(E(r(o,n)))},e):(typeof t=="number"&&(e=t),y(function(o,n){return lr(o,n,r,e)}))}function pr(r){return r===void 0&&(r=1/0),$(fe,r)}function mr(){return pr(1)}function K(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return mr()(Pe(r,de(r)))}function Y(r,t,e){r===void 0&&(r=0),e===void 0&&(e=Qt);var o=-1;return t!=null&&(me(t)?e=t:o=t),new v(function(n){var i=fr(r)?+r-e.now():r;i<0&&(i=0);var s=0;return e.schedule(function(){n.closed||(n.next(s++),0<=o?this.schedule(void 0,o):n.complete())},i)})}var uo=Array.isArray;function dr(r){return r.length===1&&uo(r[0])?r[0]:r}function Je(r,t){return y(function(e,o){var n=0;e.subscribe(b(o,function(i){return r.call(t,i,n++)&&o.next(i)}))})}function Xe(r,t,e){if(t==null&&(t=r,r=0),t<=0)return k;var o=t+r;return new v(e?function(n){var i=r;return e.schedule(function(){i<o?(n.next(i++),this.schedule()):n.complete()})}:function(n){for(var i=r;i<o&&!n.closed;)n.next(i++);n.complete()})}function Qe(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=er(r),o=dr(r);return o.length?new v(function(n){var i=o.map(function(){return[]}),s=o.map(function(){return!1});n.add(function(){i=s=null});for(var a=function(u){E(o[u]).subscribe(b(n,function(f){if(i[u].push(f),i.every(function(l){return l.length})){var m=i.map(function(l){return l.shift()});n.next(e?e.apply(void 0,D([],P(m))):m),i.some(function(l,d){return!l.length&&s[d]})&&n.complete()}},function(){s[u]=!0,!i[u].length&&n.complete()}))},c=0;!n.closed&&c<o.length;c++)a(c);return function(){i=s=null}}):k}function Ze(r){return r<=0?function(){return k}:y(function(t,e){var o=0;t.subscribe(b(e,function(n){++o<=r&&(e.next(n),r<=o&&e.complete())}))})}function hr(){return y(function(r,t){r.subscribe(b(t,V))})}function vr(r){return L(function(){return r})}function et(r,t){return t?function(e){return K(t.pipe(Ze(1),hr()),e.pipe(et(r)))}:$(function(e,o){return r(e,o).pipe(Ze(1),vr(e))})}function tt(r,t){t===void 0&&(t=Ke);var e=Y(r,t);return et(function(){return e})}function rt(){return y(function(r,t){r.subscribe(b(t,function(e){return Ye(e,t)}))})}function ot(){return y(function(r,t){r.subscribe(b(t,function(e){t.next(De.createNext(e))},function(){t.next(De.createComplete()),t.complete()},function(e){t.next(De.createError(e)),t.complete()}))})}function nt(r){return y(function(t,e){var o,n=!1,i,s=function(){o=t.subscribe(b(e,void 0,void 0,function(a){i||(i=new w,r(i).subscribe(b(e,function(){return o?s():n=!0}))),i&&i.next(a)})),n&&(o.unsubscribe(),o=null,n=!1,s())};s()})}function it(r,t){return y(function(e,o){var n=null,i=0,s=!1,a=function(){return s&&!n&&o.complete()};e.subscribe(b(o,function(c){n==null||n.unsubscribe();var u=0,f=i++;E(r(c,f)).subscribe(n=b(o,function(m){return o.next(t?t(c,m,f,u++):m)},function(){n=null,a()}))},function(){s=!0,a()}))})}var J=class{constructor(){this._subscribers=new Set}subscribe(t){return this._subscribers.add(t),{unsubscribe:()=>{this._subscribers.delete(t)}}}publish(t){let e;for(let o of this._subscribers)try{if(e=o(t),e)break}catch(n){throw n}return e}},Oe=class extends J{constructor(e){super();this._value=e}get value(){return this._value}get observers(){return this._subscribers}subscribe(e){return e(this._value),super.subscribe(e)}publish(e){if(this._value!==e)return this._value=e,super.publish(e)}};var Me=class{constructor(t,e,o){this.subscriptions=[];this.presenceSubject=new w;this.channel=t,this.params=e,this.socket=o,this.subject=new w,this.connectedSubject=new Oe(!1)}get isActive(){return this.connectedSubject.value}join(){if(this.connectedSubject.value)return this;let e=this.init().subscribe(o=>{this.connectedSubject.publish(!0),o.action==="PRESENCE"?this.presenceSubject.next(o.payload.presence):o.action==="MESSAGE"?this.subject.next(o):o.event==="KICKED_FROM_CHANNEL"&&this.leave()});return this.subscriptions.push(e),this}leave(){this.connectedSubject.publish(!1),this.presenceSubject.complete(),this.subscriptions.forEach(t=>t.unsubscribe()),this.subscriptions=[],this.subject.complete()}onPresenceUpdate(t){let e=this.presenceSubject.subscribe(t);return this.subscriptions.push(e),e}onMessage(t){let e=this.subject.pipe(Je(o=>o.action==="MESSAGE")).subscribe(o=>t(o.event,o.payload));return this.subscriptions.push(e),e}broadcast(t,e){let o={channelName:this.channel,payload:e,event:t,action:"BROADCAST"};this.socket.next(o)}broadcastFrom(t,e){let o={channelName:this.channel,payload:e,event:t,action:"BROADCAST_FROM"};this.socket.next(o)}updatePresence(t){this.socket.next({action:"UPDATE_PRESENCE",channelName:this.channel,event:"PRESENCE",payload:t})}sendMessage(t,e,o){let n=Array.isArray(o)?o:[o],i={channelName:this.channel,payload:e,event:t,addresses:n,action:"SEND_MESSAGE_TO_USER"};this.socket.next(i)}onConnectionChange(t){let e=this.connectedSubject.subscribe(t);return this.subscriptions.push(e),e}init(){return this.socket.multiplex(()=>({action:"JOIN_CHANNEL",channelName:this.channel,event:"JOIN_CHANNEL",payload:this.params}),()=>({action:"LEAVE_CHANNEL",channelName:this.channel,event:"LEAVE_CHANNEL",payload:this.params}),e=>e.channelName===this.channel)}};var Ce=class{constructor(t,e,o){this.errorMessage=t,this.errorCode=e,this.data=o}};var st=class{constructor(t,e,o,n){this._removeDoc=e,this._updateDoc=o,this._getDoc=n,this._id=t}get id(){return this._id}get doc(){return this._getDoc()}removeDoc(){let t=this._getDoc();return this._removeDoc(),t}updateDoc(t){this._updateDoc(t)}},X=class{constructor(){this._nanoid=()=>{let t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let o=0;o<21;o++)t+=e.charAt(Math.floor(Math.random()*e.length));return t};this._db={},this._broadcast=new J}get size(){return Object.keys(this._db).length}get(t){return this._db[t]?this._createPondDocument(t):null}set(t){let e=this._nanoid();return this._db[e]=t,this._broadcast.publish({oldValue:null,currentValue:t}),this._createPondDocument(e)}update(t,e){if(this._db[t])return this._db[t]=e,this._broadcast.publish({oldValue:this._db[t],currentValue:e}),this._createPondDocument(t);throw new Ce(`Key ${t} does not exist in the pond`,404,t)}createDocument(t){let e=this._createPondDocument(this._nanoid()),o=t(e);return this._db[e.id]=o,e.updateDoc(o),this._broadcast.publish({oldValue:null,currentValue:o}),e}merge(t){for(let e in t._db)this._db[e]=t._db[e];return this}*generate(){for(let t in this._db)yield this._db[t]}query(t){let e=[];for(let o in this._db){let n=this._db[o];t(n)&&e.push(this._createPondDocument(o))}return e}queryById(t){let e=[];for(let o in this._db)t(o)&&e.push(this._createPondDocument(o));return e}queryByKeys(t){return t.map(e=>this.get(e)).filter(e=>e!==null)}reduce(t,e){let o=0;for(let n in this._db)e=t(e,this._db[n],o),o++;return e}find(t){for(let e in this._db){let o=this._db[e];if(t(o))return this._createPondDocument(e)}return null}map(t){return Object.values(this._db).map(t)}clear(){Object.keys(this._db).forEach(e=>this._delete(e))}subscribe(t){return this._broadcast.subscribe(e=>{let o="UPDATE_IN_POND";e.oldValue===null?o="ADD_TO_POND":e.currentValue===null&&(o="REMOVE_FROM_POND"),t(Object.values(this._db),e.currentValue,o)})}toArray(){return Object.keys(this._db).map(t=>this._createPondDocument(t))}_delete(t){delete this._db[t],this._broadcast.publish({oldValue:this._db[t],currentValue:null})}_getDocument(t){return this._db[t]||null}_createPondDocument(t){let e=this._delete.bind(this,t),o=this.update.bind(this,t),n=this._getDocument.bind(this,t);return new st(t,e,o,n)}};var ke=class{constructor(t,e){this.socketState="CLOSED";this._retryStrategy=(t,e)=>Ge(nt(o=>{let n=Qe(Xe(1,t),o).pipe(L(([s,a])=>s),L(s=>s*s),it(s=>Y(s*e))),i=z(new Error("Could not connect to server")).pipe(ot(),tt(1e3),rt());return K(n,i)}));let o;try{o=new URL(t)}catch(s){o=new URL(window.location.toString()),o.pathname=t}let n=new URLSearchParams(e);o.search=n.toString();let i=o.protocol==="https:"?"wss:":"ws:";o.protocol!=="wss:"&&o.protocol!=="ws:"&&(o.protocol=i),this.address=o,this.channels=new X}connect(){if(this.socketState!=="CLOSED")return;this.socketState="CONNECTING";let t=ze({url:this.address.toString(),openObserver:{next:()=>{this.socketState="OPEN"}},closeObserver:{next:()=>{this.socketState="CLOSED"}},closingObserver:{next:()=>{this.socketState="CLOSING"}}});return this.socket=t,this.subscription=t.pipe(this._retryStrategy(100,1e3)).subscribe(),this}getState(){return this.socketState}createChannel(t,e){let o=this.channels.find(i=>i.channel===t);if(o)return o.doc;let n=new Me(t,e||{},this.socket);return this.channels.set(n),n}onMessage(t){var e;(e=this.socket)==null||e.subscribe(o=>{o.event&&t(o.event,o.payload)})}disconnect(){var t,e,o;(t=this.socket)==null||t.complete(),(e=this.socket)==null||e.unsubscribe(),(o=this.subscription)==null||o.unsubscribe(),this.socket=void 0,this.channels=new X}};var at=(r,t,e,o)=>{let n=document.createElement("div");n.innerHTML=t.trim();let i=n.querySelector("#"+e),s=r.querySelector("#"+e);i&&s&&i.replaceWith(s.cloneNode(!0));let a=n.firstElementChild;Le(r,a),o&&o.pageTitle&&(document.title=o.pageTitle)},Le=(r,t)=>{if(r instanceof Text&&t instanceof Text&&r.textContent!==t.textContent){r.replaceWith(t.cloneNode(!0));return}if(r instanceof Text&&t instanceof Element){r.replaceWith(t.cloneNode(!0));return}if(r instanceof Element&&t instanceof Text){r.replaceWith(t.cloneNode(!0));return}if(r.tagName!==t.tagName){r.replaceWith(t.cloneNode(!0));return}for(let o in t.attributes){let n=t.attributes[o];n&&n.name&&n.value&&(!r.hasAttribute(n.name)||r.getAttribute(n.name)!==n.value)&&r.setAttribute(n.name,n.value)}for(let o in r.attributes){let n=r.attributes[o];n&&n.name&&n.value&&(t.hasAttribute(n.name)?t.hasAttribute(n.name)&&t.getAttribute(n.name)!==n.value&&r.setAttribute(n.name,t.getAttribute(n.name)):r.removeAttribute(n.name))}let e=Math.max(r.childNodes.length,t.childNodes.length);for(let o=0;o<e;o++){let n=r.childNodes[o],i=t.childNodes[o];if(n&&i)Le(n,i);else{if(n)return fo(r,o);i&&r.appendChild(i.cloneNode(!0))}}},fo=(r,t)=>{let e=r.childNodes;for(let o=e.length-1;o>=t;o--)e[o].remove()};var x=(r,t,e)=>{let o=new CustomEvent(r,{detail:t,bubbles:!0,cancelable:!0});e?e.dispatchEvent(o):window.dispatchEvent(o)},Q=(r,t,e,o)=>{let n=t.closest("[pond-router]"),i=null;if(o&&(i=o.target.value),n){let s=n.getAttribute("pond-router"),a=t.getAttribute(e),c=t.getAttribute("pond-data-id");s&&a&&ct(r,s,{type:a,dataId:c,value:i})}},ct=(r,t,e)=>{r.broadcastFrom(`event/${t}`,e)},br=(r,t,e)=>{r.broadcastFrom(t,e)};var yr=async r=>{x("navigate-start",{location:r,shallow:!1}),history.pushState(null,"",r),await xr(r),x("navigate-end",{location:r,shallow:!1})};window.addEventListener("popstate",async()=>{x("navigate-start",{location:location.pathname,shallow:!1}),await xr(location.pathname),x("navigate-end",{location:location.pathname,shallow:!1})});var xr=async r=>{let t={"Content-Type":"text/html",Accept:"text/html","x-csrf-token":window.token,"x-router-request":"true",method:"GET"},e=await fetch(r,{headers:t}),o=e.headers;if(o.has("x-router-action")){let n=o.get("x-router-action");if(n){let i=o.get("x-router-path"),s=o.get("x-page-title"),a=o.get("x-flash-message");await ut(i,n,s,a)}}else{let n=o.get("x-router-container"),i=o.get("x-page-title"),s=o.get("x-flash-message"),a=await e.text();lo(n,a,i,s)}},gr=r=>{r.delegateEvent("a","click",async(t,e)=>{e.preventDefault();let n=t.href;await yr(n)})},ut=async(r,t,e,o)=>{switch(t){case"replace":x("navigate-start",{location:r,shallow:!1}),history.replaceState(null,"",r),x("navigate-end",{location:r,shallow:!1});break;case"redirect":await yr(r);break;case"reload":window.location.reload();break}e&&(document.title=e),o&&x("flash-message",{flashMessage:o})},lo=(r,t,e,o)=>{let n=document.querySelector(r);if(n){let i=document.createElement("div");i.innerHTML=t;let s=i.firstElementChild,a=s.getAttribute("pond-router");a&&n.setAttribute("pond-router",a),Le(n,s),e&&(document.title=e),o&&x("flash-message",{flashMessage:o})}};var ft=(r,t)=>{if(r===void 0)return t;if(t===void 0)return r;for(let e in t)t[e]instanceof Object?r[e]=ft(r[e],t[e]):t[e]===null?delete r[e]:r[e]=t[e];return r instanceof Array?r.filter(e=>e!=null):r};var Sr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},po=new RegExp(Object.keys(Sr).join("|"),"g");function Fe(r,t){return t==null&&(t=","),r.length<=0?new C([""],[]):new C(["",...Array(r.length-1).fill(t),""],r)}function _r(r){return r==null?"":r instanceof C?r.toString():Array.isArray(r)?Fe(r,"").toString():String(r).replace(po,t=>Sr[t])}var C=class{constructor(t,e){this.statics=t,this.dynamics=e}toString(){let t=this.statics[0];for(let e=0;e<this.dynamics.length;e++)this.dynamics[e]instanceof C?t+=this.dynamics[e].toString()+this.statics[e+1]:Array.isArray(this.dynamics[e])?t+=Fe(this.dynamics[e],"").toString()+this.statics[e+1]:typeof this.dynamics[e]=="object"?t+=this.parsedHtmlToString(this.dynamics[e])+this.statics[e+1]:t+=_r(this.dynamics[e])+this.statics[e+1];return t}getParts(){let t={s:this.statics};for(let e=0;e<this.dynamics.length;e++)this.dynamics[e]instanceof C?t[e]=this.dynamics[e].getParts():Array.isArray(this.dynamics[e])?t[e]=Fe(this.dynamics[e],"").getParts():this.dynamics[e]===void 0?t[e]=null:t[e]=this.dynamics[e];return t}parsedHtmlToString(t){var n;let e=t,o="";if(Array.isArray(e))return Fe(e,"").toString();if(((n=e==null?void 0:e.s)==null?void 0:n.length)>0){let i=e.s.filter(s=>s!=null);o=e.s[0];for(let s=0;s<i.length-1;s++)typeof e[s]=="object"?o+=this.parsedHtmlToString(t[s])+e.s[s+1]:o+=_r(t[s])+e.s[s+1]}return o}reconstruct(t){let e=ft(this.getParts(),t);return this.parse(e)}parse(t){let e=t,o=e.s||[""];delete e.s;let n=Object.values(e).filter(i=>i!=null);return new C(o,n)}};function Er(r,...t){return new C(r,t)}var wr=(r,t)=>{let e={},o={},n=a=>{let c=a.getAttribute("pond-router");c&&!e[c]&&(e[c]=r.onMessage(async(u,f)=>{if(f.path===c){if(u==="rendered"){let l=Er``.parse(f.rendered);o[c]=l;let d=l.toString();at(a,d,c,f.headers)}if(u==="updated"&&o[c]){let l=o[c].reconstruct(f.rendered);o[c]=l;let d=l.toString();at(a,d,c,f.headers)}f.headers&&(f.headers.pageTitle?document.title=f.headers.pageTitle:f.headers.flashMessage&&x("flash-message",{flashMessage:f.headers.flashMessage}))}}),r.broadcastFrom(`mount/${c}`,{}))},i=(a,c)=>{let u=c;u&&e[u]&&(r.broadcastFrom(`unmount/${u}`,{}),e[u].unsubscribe(),delete e[u],delete o[u])},s=(a,c)=>{let u=a.getAttribute("pond-router");c&&u?c!==u?(i(a,c),n(a)):e[u]&&r.broadcastFrom(`update/${u}`,{}):c&&e[c]?i(a,c):u&&!e[u]&&n(a)};t.watch("[pond-router]",{onAdd:n,onRemove:i,onUpdated:s})},Tr=r=>{r.onMessage(async(t,e)=>{if(t==="router"){let{action:o,path:n}=e;await ut(n,o)}else t==="emit"&&x(e.event,e.data)})};var Re=class{constructor(){this._modifiers={};let t=new MutationObserver(e=>{for(let o=0;o<e.length;o++){let n=e[o];switch(n.type){case"childList":for(let a=0;a<n.removedNodes.length;a++){let c=n.removedNodes[a];if(c instanceof HTMLElement){let u=c;for(let f in this._modifiers)u.matches(f)&&this._modifiers[f].forEach(l=>{l.onRemove&&l.onRemove(u,null)})}}for(let a=0;a<n.addedNodes.length;a++){let c=n.addedNodes[a];if(c instanceof HTMLElement){let u=c;this._addNewElement(u)}}break;case"attributes":let i=n.target,s=`[${n.attributeName}]`;for(let a in this._modifiers)if(s===a||i.matches(a))if(n.oldValue===null)this._modifiers[a].forEach(u=>{u.onAdd&&u.onAdd(i,null)});else{let c=this._modifiers[a],u=i.getAttribute(n.attributeName);c.forEach(f=>{u?f.onUpdated&&f.onUpdated(i,n.oldValue):f.onRemove&&f.onRemove(i,n.oldValue)})}}}});t.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0}),this._observer=t}watch(t,e){let o=document.querySelectorAll(t);for(let i=0;i<o.length;i++){let s=o[i];e.onAdd&&e.onAdd(s,null)}let n=this._modifiers[t]||[];n.push(e),this._modifiers[t]=n}unwatch(t){delete this._modifiers[t]}isWatching(t){return!!this._modifiers[t]}addEventListener(t,e,o){this.watch(t,{onAdd:n=>{n.addEventListener(e,i=>{o(n,i)},{capture:!0})},onRemove:n=>{n.removeEventListener(e,i=>{o(n,i)},{capture:!0})}})}delegateEvent(t,e,o){document.body.addEventListener(e,n=>{let i=n.target;if(i.tagName.toLowerCase()===t.toLowerCase())return o(i,n);let s=i.parentElement;if(s&&s.tagName.toLowerCase()===t.toLowerCase())return o(s,n);let a=i.firstElementChild;if(a&&a.tagName.toLowerCase()===t.toLowerCase())return o(a,n)})}delegateSelectorEvent(t,e,o){document.body.addEventListener(e,n=>{console.log(n,"delegateSelectorEvent");let s=n.target.closest(t);if(console.log(s,"closest",t),s)return o(s,n)})}shutdown(){for(let t in this._modifiers)this.unwatch(t);this._observer.disconnect()}_addNewElement(t){for(let e in this._modifiers)t.matches(e)&&this._modifiers[e].forEach(n=>{n.onAdd&&n.onAdd(t,null)});for(let e=0;e<t.children.length;e++)this._addNewElement(t.children[e])}};var mo=r=>{r("[pond-click]","click",()=>({value:null}))},ho=r=>{r("[pond-mouseenter]","mouseenter",()=>({value:null}))},vo=r=>{r("[pond-mouseleave]","mouseleave",()=>({value:null}))},bo=r=>{r("[pond-mousemove]","mousemove",()=>({value:null}))},yo=r=>{r("[pond-mousedown]","mousedown",()=>({value:null}))},xo=r=>{r("[pond-mouseup]","mouseup",()=>({value:null}))},go=r=>{r("[pond-double-click]","dblclick",()=>({value:null}))},_o=r=>{r("[pond-drag-start]","dragstart",(t,e)=>{let o=e.getBoundingClientRect(),n={top:o.top,left:o.left,width:o.width,height:o.height};return{value:null,dragData:n}})},So=r=>{r("[pond-drag-end]","dragend",(t,e)=>{let o=e.getBoundingClientRect(),n={top:o.top,left:o.left,width:o.width,height:o.height};return{value:null,dragData:n}})},Eo=r=>{r("[pond-drag-over]","dragover",(t,e)=>{let o=e.getBoundingClientRect(),n={top:o.top,left:o.left,width:o.width,height:o.height};return{value:null,dragData:n}})},wo=r=>{r("[pond-drag-enter]","dragenter",(t,e)=>{let o=e.getBoundingClientRect(),n={top:o.top,left:o.left,width:o.width,height:o.height};return{value:null,dragData:n}})},To=r=>{r("[pond-drag-leave]","dragleave",(t,e)=>{let o=e.getBoundingClientRect(),n={top:o.top,left:o.left,width:o.width,height:o.height};return{value:null,dragData:n}})},Ao=r=>{r("[pond-drop]","drop",(t,e)=>{let o=e.getBoundingClientRect(),n={top:o.top,left:o.left,width:o.width,height:o.height};return{value:null,dragData:n}})},Ar=r=>{mo(r),ho(r),vo(r),bo(r),yo(r),xo(r),go(r),_o(r),So(r),Eo(r),wo(r),To(r),Ao(r)};var Po=(r,t)=>{t.addEventListener("[pond-keyup]","keyup",(e,o)=>{Q(r,e,"pond-keyup",o)})},Do=(r,t)=>{t.addEventListener("[pond-keydown]","keydown",(e,o)=>{Q(r,e,"pond-keydown",o)})},Oo=(r,t)=>{t.addEventListener("[pond-keypress]","keypress",(e,o)=>{Q(r,e,"pond-keypress",o)})},Mo=(r,t)=>{t.addEventListener("[pond-change]","change",(e,o)=>{Q(r,e,"pond-change",o)})},Co=(r,t)=>{t.addEventListener("[pond-window-keyup]","keyup",(e,o)=>{let n=e.closest("[pond-router]"),i=o.key;if(n){let s=n.getAttribute("pond-router"),a=e.getAttribute("pond-window-keyup");s&&a&&i&&r.broadcastFrom(`event/${s}`,{type:a,key:i})}})},ko=(r,t)=>{t.addEventListener("[pond-window-keydown]","keydown",(e,o)=>{let n=e.closest("[pond-router]"),i=o.key;if(n){let s=n.getAttribute("pond-router"),a=e.getAttribute("pond-window-keydown");s&&a&&i&&r.broadcastFrom(`event/${s}`,{type:a,key:i})}})},Lo=(r,t)=>{t.addEventListener("[pond-window-keypress]","keypress",(e,o)=>{let n=e.closest("[pond-router]"),i=o.key;if(n){let s=n.getAttribute("pond-router"),a=e.getAttribute("pond-window-keypress");s&&a&&i&&r.broadcastFrom(`event/${s}`,{type:a,key:i})}})},Pr=(r,t)=>{Po(r,t),Do(r,t),Oo(r,t),Mo(r,t),Co(r,t),ko(r,t),Lo(r,t)};var Fo=(r,t)=>{t.addEventListener("[pond-focus]","focus",e=>{let o=e.closest("[pond-router]");if(o){let n=o.getAttribute("pond-router"),i=e.getAttribute("pond-focus"),s=e.getAttribute("pond-data-id");n&&i&&r.broadcastFrom(`event/${n}`,{type:i,dataId:s})}})},Ro=(r,t)=>{t.addEventListener("[pond-blur]","blur",e=>{let o=e.closest("[pond-router]");if(o){let n=o.getAttribute("pond-router"),i=e.getAttribute("pond-blur"),s=e.getAttribute("pond-data-id");n&&i&&r.broadcastFrom(`event/${n}`,{type:i,dataId:s})}})},Io=(r,t)=>{t.addEventListener("[pond-change]","change",e=>{let o=e.closest("[pond-router]");if(o){let n=o.getAttribute("pond-router"),i=e.getAttribute("pond-change"),s=e.getAttribute("pond-data-id");n&&i&&r.broadcastFrom(`event/${n}`,{type:i,dataId:s})}})},No=(r,t)=>{t.addEventListener("[pond-input]","input",e=>{let o=e.closest("[pond-router]");if(o){let n=o.getAttribute("pond-router"),i=e.getAttribute("pond-input"),s=e.getAttribute("pond-data-id");n&&i&&r.broadcastFrom(`event/${n}`,{type:i,dataId:s})}})},Wo=(r,t)=>{t.addEventListener("[pond-submit]","submit",(e,o)=>{o.preventDefault();let n=e.closest("[pond-router]");if(n){let i=n.getAttribute("pond-router"),s=e.getAttribute("pond-submit"),a=e.getAttribute("pond-data-id");i&&s&&r.broadcastFrom(`event/${i}`,{type:s,dataId:a})}})},Dr=(r,t)=>{Fo(r,t),Ro(r,t),Io(r,t),No(r,t),Wo(r,t)};var Or=(r,t,e,o)=>{let n=new XMLHttpRequest;return n.open("POST",o),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("x-csrf-token",e),n.setRequestHeader("x-router-request","true"),n.setRequestHeader("x-router-path",r),n.setRequestHeader("x-router-event",t),n.onreadystatechange=()=>{if(n.readyState===4&&n.status===200){let i=JSON.parse(n.responseText);x("pond-upload-success",i)}else x("pond-upload-error",n.responseText)},n.onloadstart=()=>x("pond-upload-start",{}),n.onloadend=()=>x("pond-upload-end",{}),n.onprogress=i=>{i.lengthComputable&&x("pond-upload-progress",{progress:Math.round(i.loaded/i.total*100)})},n},Ho=(r,t,e,o,n,i)=>{let s=i.onMessage((a,c)=>{if(a==="pondUploadToken"&&c.token&&c.identifier===t&&c.uploadPath){s.unsubscribe();let u=Or(n,o,c.token,c.uploadPath),f=new FormData;f.append(e,r,r.name),u.send(f)}else a==="pondUploadError"&&c.identifier===t&&(s.unsubscribe(),x("pond-upload-error",c.error))});return s},Uo=r=>{let t=[];if(!r)return t;for(let e=0;e<r.length;e++)t.push({path:`/${r[e].name}`,file:r[e]});return t},jo=r=>new Promise(async t=>{let e=[];for(let i=0;i<r.length;i++){let s=r[i].webkitGetAsEntry();s&&e.push(s)}let o=e.map(i=>Mr(i)),n=await Promise.all(o);t(n.flat())}),Mr=(r,t="/")=>new Promise(e=>{if(r.isFile)r.file(n=>{let i=`${t}${n.name}`;e([{path:i,file:n}])});else if(r.isDirectory){let o=r,n=o.createReader(),i=[];n.readEntries(async s=>{for(let a=0;a<s.length;a++){let c=s[a],u=`${t}${o.name}/`,f=await Mr(c,u);i.push(...f)}e(i)})}}),Cr=async(r,t,e,o)=>{let n=[],i=[],s=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);r instanceof DataTransferItemList?n=await jo(r):r instanceof FileList&&(n=Uo(r));let a=t.onMessage((u,f)=>{if(u==="pondUploadToken"&&f.token&&f.identifier===s&&f.uploadPath){a.unsubscribe(),i.forEach(d=>d.unsubscribe());let m=Or(e,o,f.token,f.uploadPath),l=new FormData;n.forEach(d=>l.append(d.path,d.file,d.file.name)),m.send(l)}else u==="pondUploadError"&&f.identifier===s&&(a.unsubscribe(),i.forEach(m=>m.unsubscribe()),x("pond-upload-error",f.error))});return{metaData:n.map(u=>{let f=kr(u.file)[0],m=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return i.push(Ho(u.file,m,u.path,o,e,t)),{name:f.name,size:f.size,type:f.type,identifier:m,lastModified:f.lastModified,lastModifiedDate:f.lastModifiedDate}}),longRandom:s}},kr=r=>{let t=[];if(r instanceof FileList)for(let e=0;e<r.length;e++)t.push({name:r[e].name,size:r[e].size,type:r[e].type,lastModified:r[e].lastModified,lastModifiedDate:new Date(r[e].lastModified)});else r instanceof File&&t.push({name:r.name,size:r.size,type:r.type,lastModified:r.lastModified,lastModifiedDate:new Date(r.lastModified)});return t},Bo=r=>{r("[pond-file]","change",(t,e)=>{let n=e.files;if(n){let i=kr(n);return{value:null,files:i}}return null})},Vo=(r,t)=>{t("[pond-upload]","submit",async(e,o,n,i)=>{e.preventDefault();let a=o.querySelector('input[type="file"]').files;if(a){let{metaData:c,longRandom:u}=await Cr(a,r,n,i);return{value:null,files:c,event:`${n}/upload/token`,metadata:{identifier:u,type:"UPLOAD_REQUEST"}}}return null})},Go=(r,t)=>{t("[pond-drop-upload]","drop",async(e,o,n,i)=>{var a;let s=(a=e.dataTransfer)==null?void 0:a.items;if(s){let{metaData:c,longRandom:u}=await Cr(s,r,n,i);return{value:null,files:c,event:`${n}/upload/token`,metadata:{identifier:u,type:"UPLOAD_REQUEST"}}}return null})},Lr=(r,t)=>{Bo(t),Vo(r,t),Go(r,t)};var qo=async(r,t,e,o,n)=>{n.preventDefault();let i=t.replace("[","").replace("]",""),s=o.closest("[pond-router]"),a=o.getAttribute(i),c=o.getAttribute("pond-data-id");if(s&&a){let u=s.getAttribute("pond-router");if(u){let f=await e(n,o,u,a);f&&(f.event?br(r,f.event,We(Ne({},f),{dataId:c,type:a})):ct(r,u,We(Ne({},f),{dataId:c,type:a})))}}},Fr=(r,t)=>(e,o,n)=>{t.addEventListener(e,o,async(i,s)=>{await qo(r,e,n,i,s)})};var Rr=()=>{let r=new ke("/live");r.connect();let t=!1;r.onMessage((e,o)=>{if(e==="token"&&!t){window.token=o.csrfToken,t=!0;let n=new Re,i=r.createChannel(`/${o.nanoId}`,{clientId:o.csrfToken});i.join();let s=!1;i.onConnectionChange(a=>{if(a){let c=Fr(i,n);wr(i,n),Ar(c),Pr(i,n),Dr(i,n),gr(n),Tr(i),Lr(i,c),s||(s=!0,x("pondReady",i))}})}})};window.addEventListener("load",()=>{Rr()});})();
