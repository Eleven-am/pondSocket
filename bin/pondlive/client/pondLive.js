"use strict";(()=>{var Pr=Object.create;var Le=Object.defineProperty,Lr=Object.defineProperties,Dr=Object.getOwnPropertyDescriptor,Fr=Object.getOwnPropertyDescriptors,Rr=Object.getOwnPropertyNames,at=Object.getOwnPropertySymbols,Ir=Object.getPrototypeOf,ct=Object.prototype.hasOwnProperty,Nr=Object.prototype.propertyIsEnumerable;var st=(t,r,e)=>r in t?Le(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,De=(t,r)=>{for(var e in r||(r={}))ct.call(r,e)&&st(t,e,r[e]);if(at)for(var e of at(r))Nr.call(r,e)&&st(t,e,r[e]);return t},Fe=(t,r)=>Lr(t,Fr(r));var Wr=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports);var Hr=(t,r,e,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Rr(r))!ct.call(t,n)&&n!==e&&Le(t,n,{get:()=>r[n],enumerable:!(o=Dr(r,n))||o.enumerable});return t};var Ur=(t,r,e)=>(e=t!=null?Pr(Ir(t)):{},Hr(r||!t||!t.__esModule?Le(e,"default",{value:t,enumerable:!0}):e,t));var kt=Wr((Bo,Z)=>{var ut,ft,pt,lt,mt,dt,ht,vt,bt,X,Re,yt,xt,gt,H,_t,St,Et,wt,At,Tt,Mt,Ct,Ot,Q;(function(t){var r=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(o){t(e(r,e(o)))}):typeof Z=="object"&&typeof Z.exports=="object"?t(e(r,e(Z.exports))):t(e(r));function e(o,n){return o!==r&&(typeof Object.create=="function"?Object.defineProperty(o,"__esModule",{value:!0}):o.__esModule=!0),function(i,a){return o[i]=n?n(i,a):a}}})(function(t){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,n){o.__proto__=n}||function(o,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(o[i]=n[i])};ut=function(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");r(o,n);function i(){this.constructor=o}o.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)},ft=Object.assign||function(o){for(var n,i=1,a=arguments.length;i<a;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(o[s]=n[s])}return o},pt=function(o,n){var i={};for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&n.indexOf(a)<0&&(i[a]=o[a]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,a=Object.getOwnPropertySymbols(o);s<a.length;s++)n.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(o,a[s])&&(i[a[s]]=o[a[s]]);return i},lt=function(o,n,i,a){var s=arguments.length,c=s<3?n:a===null?a=Object.getOwnPropertyDescriptor(n,i):a,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,n,i,a);else for(var f=o.length-1;f>=0;f--)(u=o[f])&&(c=(s<3?u(c):s>3?u(n,i,c):u(n,i))||c);return s>3&&c&&Object.defineProperty(n,i,c),c},mt=function(o,n){return function(i,a){n(i,a,o)}},dt=function(o,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,n)},ht=function(o,n,i,a){function s(c){return c instanceof i?c:new i(function(u){u(c)})}return new(i||(i=Promise))(function(c,u){function f(d){try{p(a.next(d))}catch(_){u(_)}}function m(d){try{p(a.throw(d))}catch(_){u(_)}}function p(d){d.done?c(d.value):s(d.value).then(f,m)}p((a=a.apply(o,n||[])).next())})},vt=function(o,n){var i={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},a,s,c,u;return u={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function f(p){return function(d){return m([p,d])}}function m(p){if(a)throw new TypeError("Generator is already executing.");for(;i;)try{if(a=1,s&&(c=p[0]&2?s.return:p[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,p[1])).done)return c;switch(s=0,c&&(p=[p[0]&2,c.value]),p[0]){case 0:case 1:c=p;break;case 4:return i.label++,{value:p[1],done:!1};case 5:i.label++,s=p[1],p=[0];continue;case 7:p=i.ops.pop(),i.trys.pop();continue;default:if(c=i.trys,!(c=c.length>0&&c[c.length-1])&&(p[0]===6||p[0]===2)){i=0;continue}if(p[0]===3&&(!c||p[1]>c[0]&&p[1]<c[3])){i.label=p[1];break}if(p[0]===6&&i.label<c[1]){i.label=c[1],c=p;break}if(c&&i.label<c[2]){i.label=c[2],i.ops.push(p);break}c[2]&&i.ops.pop(),i.trys.pop();continue}p=n.call(o,i)}catch(d){p=[6,d],s=0}finally{a=c=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},bt=function(o,n){for(var i in o)i!=="default"&&!Object.prototype.hasOwnProperty.call(n,i)&&Q(n,o,i)},Q=Object.create?function(o,n,i,a){a===void 0&&(a=i);var s=Object.getOwnPropertyDescriptor(n,i);(!s||("get"in s?!n.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return n[i]}}),Object.defineProperty(o,a,s)}:function(o,n,i,a){a===void 0&&(a=i),o[a]=n[i]},X=function(o){var n=typeof Symbol=="function"&&Symbol.iterator,i=n&&o[n],a=0;if(i)return i.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&a>=o.length&&(o=void 0),{value:o&&o[a++],done:!o}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},Re=function(o,n){var i=typeof Symbol=="function"&&o[Symbol.iterator];if(!i)return o;var a=i.call(o),s,c=[],u;try{for(;(n===void 0||n-- >0)&&!(s=a.next()).done;)c.push(s.value)}catch(f){u={error:f}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(u)throw u.error}}return c},yt=function(){for(var o=[],n=0;n<arguments.length;n++)o=o.concat(Re(arguments[n]));return o},xt=function(){for(var o=0,n=0,i=arguments.length;n<i;n++)o+=arguments[n].length;for(var a=Array(o),s=0,n=0;n<i;n++)for(var c=arguments[n],u=0,f=c.length;u<f;u++,s++)a[s]=c[u];return a},gt=function(o,n,i){if(i||arguments.length===2)for(var a=0,s=n.length,c;a<s;a++)(c||!(a in n))&&(c||(c=Array.prototype.slice.call(n,0,a)),c[a]=n[a]);return o.concat(c||Array.prototype.slice.call(n))},H=function(o){return this instanceof H?(this.v=o,this):new H(o)},_t=function(o,n,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=i.apply(o,n||[]),s,c=[];return s={},u("next"),u("throw"),u("return"),s[Symbol.asyncIterator]=function(){return this},s;function u(l){a[l]&&(s[l]=function(S){return new Promise(function(T,W){c.push([l,S,T,W])>1||f(l,S)})})}function f(l,S){try{m(a[l](S))}catch(T){_(c[0][3],T)}}function m(l){l.value instanceof H?Promise.resolve(l.value.v).then(p,d):_(c[0][2],l)}function p(l){f("next",l)}function d(l){f("throw",l)}function _(l,S){l(S),c.shift(),c.length&&f(c[0][0],c[0][1])}},St=function(o){var n,i;return n={},a("next"),a("throw",function(s){throw s}),a("return"),n[Symbol.iterator]=function(){return this},n;function a(s,c){n[s]=o[s]?function(u){return(i=!i)?{value:H(o[s](u)),done:s==="return"}:c?c(u):u}:c}},Et=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=o[Symbol.asyncIterator],i;return n?n.call(o):(o=typeof X=="function"?X(o):o[Symbol.iterator](),i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i);function a(c){i[c]=o[c]&&function(u){return new Promise(function(f,m){u=o[c](u),s(f,m,u.done,u.value)})}}function s(c,u,f,m){Promise.resolve(m).then(function(p){c({value:p,done:f})},u)}},wt=function(o,n){return Object.defineProperty?Object.defineProperty(o,"raw",{value:n}):o.raw=n,o};var e=Object.create?function(o,n){Object.defineProperty(o,"default",{enumerable:!0,value:n})}:function(o,n){o.default=n};At=function(o){if(o&&o.__esModule)return o;var n={};if(o!=null)for(var i in o)i!=="default"&&Object.prototype.hasOwnProperty.call(o,i)&&Q(n,o,i);return e(n,o),n},Tt=function(o){return o&&o.__esModule?o:{default:o}},Mt=function(o,n,i,a){if(i==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof n=="function"?o!==n||!a:!n.has(o))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?a:i==="a"?a.call(o):a?a.value:n.get(o)},Ct=function(o,n,i,a,s){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof n=="function"?o!==n||!s:!n.has(o))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?s.call(o,i):s?s.value=i:n.set(o,i),i},Ot=function(o,n){if(n===null||typeof n!="object"&&typeof n!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof o=="function"?n===o:o.has(n)},t("__extends",ut),t("__assign",ft),t("__rest",pt),t("__decorate",lt),t("__param",mt),t("__metadata",dt),t("__awaiter",ht),t("__generator",vt),t("__exportStar",bt),t("__createBinding",Q),t("__values",X),t("__read",Re),t("__spread",yt),t("__spreadArrays",xt),t("__spreadArray",gt),t("__await",H),t("__asyncGenerator",_t),t("__asyncDelegator",St),t("__asyncValues",Et),t("__makeTemplateObject",wt),t("__importStar",At),t("__importDefault",Tt),t("__classPrivateFieldGet",Mt),t("__classPrivateFieldSet",Ct),t("__classPrivateFieldIn",Ot)})});var Pt=Ur(kt(),1),{__extends:g,__assign:Lt,__rest:Go,__decorate:zo,__param:qo,__metadata:$o,__awaiter:Dt,__generator:ee,__exportStar:Ko,__createBinding:Vo,__values:F,__read:M,__spread:Yo,__spreadArrays:Jo,__spreadArray:C,__await:te,__asyncGenerator:Ft,__asyncDelegator:Xo,__asyncValues:Rt,__makeTemplateObject:Qo,__importStar:Zo,__importDefault:en,__classPrivateFieldGet:tn,__classPrivateFieldSet:rn,__classPrivateFieldIn:on}=Pt.default;function h(t){return typeof t=="function"}function re(t){var r=function(o){Error.call(o),o.stack=new Error().stack},e=t(r);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var oe=re(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(o,n){return n+1+") "+o.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function R(t,r){if(t){var e=t.indexOf(r);0<=e&&t.splice(e,1)}}var k=function(){function t(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var r,e,o,n,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var s=F(a),c=s.next();!c.done;c=s.next()){var u=c.value;u.remove(this)}}catch(l){r={error:l}}finally{try{c&&!c.done&&(e=s.return)&&e.call(s)}finally{if(r)throw r.error}}else a.remove(this);var f=this.initialTeardown;if(h(f))try{f()}catch(l){i=l instanceof oe?l.errors:[l]}var m=this._finalizers;if(m){this._finalizers=null;try{for(var p=F(m),d=p.next();!d.done;d=p.next()){var _=d.value;try{It(_)}catch(l){i=i!=null?i:[],l instanceof oe?i=C(C([],M(i)),M(l.errors)):i.push(l)}}}catch(l){o={error:l}}finally{try{d&&!d.done&&(n=p.return)&&n.call(p)}finally{if(o)throw o.error}}}if(i)throw new oe(i)}},t.prototype.add=function(r){var e;if(r&&r!==this)if(this.closed)It(r);else{if(r instanceof t){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(r)}},t.prototype._hasParent=function(r){var e=this._parentage;return e===r||Array.isArray(e)&&e.includes(r)},t.prototype._addParent=function(r){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(r),e):e?[e,r]:r},t.prototype._removeParent=function(r){var e=this._parentage;e===r?this._parentage=null:Array.isArray(e)&&R(e,r)},t.prototype.remove=function(r){var e=this._finalizers;e&&R(e,r),r instanceof t&&r._removeParent(this)},t.EMPTY=function(){var r=new t;return r.closed=!0,r}(),t}();var Ie=k.EMPTY;function ne(t){return t instanceof k||t&&"closed"in t&&h(t.remove)&&h(t.add)&&h(t.unsubscribe)}function It(t){h(t)?t():t.unsubscribe()}var O={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var U={setTimeout:function(t,r){for(var e=[],o=2;o<arguments.length;o++)e[o-2]=arguments[o];var n=U.delegate;return n!=null&&n.setTimeout?n.setTimeout.apply(n,C([t,r],M(e))):setTimeout.apply(void 0,C([t,r],M(e)))},clearTimeout:function(t){var r=U.delegate;return((r==null?void 0:r.clearTimeout)||clearTimeout)(t)},delegate:void 0};function ie(t){U.setTimeout(function(){var r=O.onUnhandledError;if(r)r(t);else throw t})}function G(){}var Nt=function(){return Ne("C",void 0,void 0)}();function Wt(t){return Ne("E",void 0,t)}function Ht(t){return Ne("N",t,void 0)}function Ne(t,r,e){return{kind:t,value:r,error:e}}var I=null;function j(t){if(O.useDeprecatedSynchronousErrorHandling){var r=!I;if(r&&(I={errorThrown:!1,error:null}),t(),r){var e=I,o=e.errorThrown,n=e.error;if(I=null,o)throw n}}else t()}function Ut(t){O.useDeprecatedSynchronousErrorHandling&&I&&(I.errorThrown=!0,I.error=t)}var N=function(t){g(r,t);function r(e){var o=t.call(this)||this;return o.isStopped=!1,e?(o.destination=e,ne(e)&&e.add(o)):o.destination=zr,o}return r.create=function(e,o,n){return new se(e,o,n)},r.prototype.next=function(e){this.isStopped?He(Ht(e),this):this._next(e)},r.prototype.error=function(e){this.isStopped?He(Wt(e),this):(this.isStopped=!0,this._error(e))},r.prototype.complete=function(){this.isStopped?He(Nt,this):(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},r.prototype._next=function(e){this.destination.next(e)},r.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},r.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},r}(k);var jr=Function.prototype.bind;function We(t,r){return jr.call(t,r)}var Br=function(){function t(r){this.partialObserver=r}return t.prototype.next=function(r){var e=this.partialObserver;if(e.next)try{e.next(r)}catch(o){ae(o)}},t.prototype.error=function(r){var e=this.partialObserver;if(e.error)try{e.error(r)}catch(o){ae(o)}else ae(r)},t.prototype.complete=function(){var r=this.partialObserver;if(r.complete)try{r.complete()}catch(e){ae(e)}},t}(),se=function(t){g(r,t);function r(e,o,n){var i=t.call(this)||this,a;if(h(e)||!e)a={next:e!=null?e:void 0,error:o!=null?o:void 0,complete:n!=null?n:void 0};else{var s;i&&O.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=function(){return i.unsubscribe()},a={next:e.next&&We(e.next,s),error:e.error&&We(e.error,s),complete:e.complete&&We(e.complete,s)}):a=e}return i.destination=new Br(a),i}return r}(N);function ae(t){O.useDeprecatedSynchronousErrorHandling?Ut(t):ie(t)}function Gr(t){throw t}function He(t,r){var e=O.onStoppedNotification;e&&U.setTimeout(function(){return e(t,r)})}var zr={closed:!0,next:G,error:Gr,complete:G};var B=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function ce(t){return t}function Ue(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return je(t)}function je(t){return t.length===0?ce:t.length===1?t[0]:function(e){return t.reduce(function(o,n){return n(o)},e)}}var v=function(){function t(r){r&&(this._subscribe=r)}return t.prototype.lift=function(r){var e=new t;return e.source=this,e.operator=r,e},t.prototype.subscribe=function(r,e,o){var n=this,i=$r(r)?r:new se(r,e,o);return j(function(){var a=n,s=a.operator,c=a.source;i.add(s?s.call(i,c):c?n._subscribe(i):n._trySubscribe(i))}),i},t.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(e){r.error(e)}},t.prototype.forEach=function(r,e){var o=this;return e=jt(e),new e(function(n,i){var a=new se({next:function(s){try{r(s)}catch(c){i(c),a.unsubscribe()}},error:i,complete:n});o.subscribe(a)})},t.prototype._subscribe=function(r){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(r)},t.prototype[B]=function(){return this},t.prototype.pipe=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return je(r)(this)},t.prototype.toPromise=function(r){var e=this;return r=jt(r),new r(function(o,n){var i;e.subscribe(function(a){return i=a},function(a){return n(a)},function(){return o(i)})})},t.create=function(r){return new t(r)},t}();function jt(t){var r;return(r=t!=null?t:O.Promise)!==null&&r!==void 0?r:Promise}function qr(t){return t&&h(t.next)&&h(t.error)&&h(t.complete)}function $r(t){return t&&t instanceof N||qr(t)&&ne(t)}var Bt=re(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var w=function(t){g(r,t);function r(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return r.prototype.lift=function(e){var o=new ue(this,this);return o.operator=e,o},r.prototype._throwIfClosed=function(){if(this.closed)throw new Bt},r.prototype.next=function(e){var o=this;j(function(){var n,i;if(o._throwIfClosed(),!o.isStopped){o.currentObservers||(o.currentObservers=Array.from(o.observers));try{for(var a=F(o.currentObservers),s=a.next();!s.done;s=a.next()){var c=s.value;c.next(e)}}catch(u){n={error:u}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}}})},r.prototype.error=function(e){var o=this;j(function(){if(o._throwIfClosed(),!o.isStopped){o.hasError=o.isStopped=!0,o.thrownError=e;for(var n=o.observers;n.length;)n.shift().error(e)}})},r.prototype.complete=function(){var e=this;j(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var o=e.observers;o.length;)o.shift().complete()}})},r.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(r.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),r.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},r.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},r.prototype._innerSubscribe=function(e){var o=this,n=this,i=n.hasError,a=n.isStopped,s=n.observers;return i||a?Ie:(this.currentObservers=null,s.push(e),new k(function(){o.currentObservers=null,R(s,e)}))},r.prototype._checkFinalizedStatuses=function(e){var o=this,n=o.hasError,i=o.thrownError,a=o.isStopped;n?e.error(i):a&&e.complete()},r.prototype.asObservable=function(){var e=new v;return e.source=this,e},r.create=function(e,o){return new ue(e,o)},r}(v);var ue=function(t){g(r,t);function r(e,o){var n=t.call(this)||this;return n.destination=e,n.source=o,n}return r.prototype.next=function(e){var o,n;(n=(o=this.destination)===null||o===void 0?void 0:o.next)===null||n===void 0||n.call(o,e)},r.prototype.error=function(e){var o,n;(n=(o=this.destination)===null||o===void 0?void 0:o.error)===null||n===void 0||n.call(o,e)},r.prototype.complete=function(){var e,o;(o=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||o===void 0||o.call(e)},r.prototype._subscribe=function(e){var o,n;return(n=(o=this.source)===null||o===void 0?void 0:o.subscribe(e))!==null&&n!==void 0?n:Ie},r}(w);var z={now:function(){return(z.delegate||Date).now()},delegate:void 0};var fe=function(t){g(r,t);function r(e,o,n){e===void 0&&(e=1/0),o===void 0&&(o=1/0),n===void 0&&(n=z);var i=t.call(this)||this;return i._bufferSize=e,i._windowTime=o,i._timestampProvider=n,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=o===1/0,i._bufferSize=Math.max(1,e),i._windowTime=Math.max(1,o),i}return r.prototype.next=function(e){var o=this,n=o.isStopped,i=o._buffer,a=o._infiniteTimeWindow,s=o._timestampProvider,c=o._windowTime;n||(i.push(e),!a&&i.push(s.now()+c)),this._trimBuffer(),t.prototype.next.call(this,e)},r.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var o=this._innerSubscribe(e),n=this,i=n._infiniteTimeWindow,a=n._buffer,s=a.slice(),c=0;c<s.length&&!e.closed;c+=i?1:2)e.next(s[c]);return this._checkFinalizedStatuses(e),o},r.prototype._trimBuffer=function(){var e=this,o=e._bufferSize,n=e._timestampProvider,i=e._buffer,a=e._infiniteTimeWindow,s=(a?1:2)*o;if(o<1/0&&s<i.length&&i.splice(0,i.length-s),!a){for(var c=n.now(),u=0,f=1;f<i.length&&i[f]<=c;f+=2)u=f;u&&i.splice(0,u+1)}},r}(w);var Kr={url:"",deserializer:function(t){return JSON.parse(t.data)},serializer:function(t){return JSON.stringify(t)}},Vr="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",Gt=function(t){g(r,t);function r(e,o){var n=t.call(this)||this;if(n._socket=null,e instanceof v)n.destination=o,n.source=e;else{var i=n._config=Lt({},Kr);if(n._output=new w,typeof e=="string")i.url=e;else for(var a in e)e.hasOwnProperty(a)&&(i[a]=e[a]);if(!i.WebSocketCtor&&WebSocket)i.WebSocketCtor=WebSocket;else if(!i.WebSocketCtor)throw new Error("no WebSocket constructor can be found");n.destination=new fe}return n}return r.prototype.lift=function(e){var o=new r(this._config,this.destination);return o.operator=e,o.source=this,o},r.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new fe),this._output=new w},r.prototype.multiplex=function(e,o,n){var i=this;return new v(function(a){try{i.next(e())}catch(c){a.error(c)}var s=i.subscribe({next:function(c){try{n(c)&&a.next(c)}catch(u){a.error(u)}},error:function(c){return a.error(c)},complete:function(){return a.complete()}});return function(){try{i.next(o())}catch(c){a.error(c)}s.unsubscribe()}})},r.prototype._connectSocket=function(){var e=this,o=this._config,n=o.WebSocketCtor,i=o.protocol,a=o.url,s=o.binaryType,c=this._output,u=null;try{u=i?new n(a,i):new n(a),this._socket=u,s&&(this._socket.binaryType=s)}catch(m){c.error(m);return}var f=new k(function(){e._socket=null,u&&u.readyState===1&&u.close()});u.onopen=function(m){var p=e._socket;if(!p){u.close(),e._resetState();return}var d=e._config.openObserver;d&&d.next(m);var _=e.destination;e.destination=N.create(function(l){if(u.readyState===1)try{var S=e._config.serializer;u.send(S(l))}catch(T){e.destination.error(T)}},function(l){var S=e._config.closingObserver;S&&S.next(void 0),l&&l.code?u.close(l.code,l.reason):c.error(new TypeError(Vr)),e._resetState()},function(){var l=e._config.closingObserver;l&&l.next(void 0),u.close(),e._resetState()}),_&&_ instanceof fe&&f.add(_.subscribe(e.destination))},u.onerror=function(m){e._resetState(),c.error(m)},u.onclose=function(m){u===e._socket&&e._resetState();var p=e._config.closeObserver;p&&p.next(m),m.wasClean?c.complete():c.error(m)},u.onmessage=function(m){try{var p=e._config.deserializer;c.next(p(m))}catch(d){c.error(d)}}},r.prototype._subscribe=function(e){var o=this,n=this.source;return n?n.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add(function(){var i=o._socket;o._output.observers.length===0&&(i&&(i.readyState===1||i.readyState===0)&&i.close(),o._resetState())}),e)},r.prototype.unsubscribe=function(){var e=this._socket;e&&(e.readyState===1||e.readyState===0)&&e.close(),this._resetState(),t.prototype.unsubscribe.call(this)},r}(ue);function Be(t){return new Gt(t)}function Yr(t){return h(t==null?void 0:t.lift)}function y(t){return function(r){if(Yr(r))return r.lift(function(e){try{return t(e,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function b(t,r,e,o,n){return new Jr(t,r,e,o,n)}var Jr=function(t){g(r,t);function r(e,o,n,i,a,s){var c=t.call(this,e)||this;return c.onFinalize=a,c.shouldUnsubscribe=s,c._next=o?function(u){try{o(u)}catch(f){e.error(f)}}:t.prototype._next,c._error=i?function(u){try{i(u)}catch(f){e.error(f)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=n?function(){try{n()}catch(u){e.error(u)}finally{this.unsubscribe()}}:t.prototype._complete,c}return r.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var o=this.closed;t.prototype.unsubscribe.call(this),!o&&((e=this.onFinalize)===null||e===void 0||e.call(this))}},r}(N);var zt=function(t){g(r,t);function r(e,o){return t.call(this)||this}return r.prototype.schedule=function(e,o){return o===void 0&&(o=0),this},r}(k);var q={setInterval:function(t,r){for(var e=[],o=2;o<arguments.length;o++)e[o-2]=arguments[o];var n=q.delegate;return n!=null&&n.setInterval?n.setInterval.apply(n,C([t,r],M(e))):setInterval.apply(void 0,C([t,r],M(e)))},clearInterval:function(t){var r=q.delegate;return((r==null?void 0:r.clearInterval)||clearInterval)(t)},delegate:void 0};var qt=function(t){g(r,t);function r(e,o){var n=t.call(this,e,o)||this;return n.scheduler=e,n.work=o,n.pending=!1,n}return r.prototype.schedule=function(e,o){if(o===void 0&&(o=0),this.closed)return this;this.state=e;var n=this.id,i=this.scheduler;return n!=null&&(this.id=this.recycleAsyncId(i,n,o)),this.pending=!0,this.delay=o,this.id=this.id||this.requestAsyncId(i,this.id,o),this},r.prototype.requestAsyncId=function(e,o,n){return n===void 0&&(n=0),q.setInterval(e.flush.bind(e,this),n)},r.prototype.recycleAsyncId=function(e,o,n){if(n===void 0&&(n=0),n!=null&&this.delay===n&&this.pending===!1)return o;q.clearInterval(o)},r.prototype.execute=function(e,o){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,o);if(n)return n;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},r.prototype._execute=function(e,o){var n=!1,i;try{this.work(e)}catch(a){n=!0,i=a||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),i},r.prototype.unsubscribe=function(){if(!this.closed){var e=this,o=e.id,n=e.scheduler,i=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,R(i,this),o!=null&&(this.id=this.recycleAsyncId(n,o,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},r}(zt);var Ge=function(){function t(r,e){e===void 0&&(e=t.now),this.schedulerActionCtor=r,this.now=e}return t.prototype.schedule=function(r,e,o){return e===void 0&&(e=0),new this.schedulerActionCtor(this,r).schedule(o,e)},t.now=z.now,t}();var $t=function(t){g(r,t);function r(e,o){o===void 0&&(o=Ge.now);var n=t.call(this,e,o)||this;return n.actions=[],n._active=!1,n._scheduled=void 0,n}return r.prototype.flush=function(e){var o=this.actions;if(this._active){o.push(e);return}var n;this._active=!0;do if(n=e.execute(e.state,e.delay))break;while(e=o.shift());if(this._active=!1,n){for(;e=o.shift();)e.unsubscribe();throw n}},r}(Ge);var ze=new $t(qt),Kt=ze;var L=new v(function(t){return t.complete()});function pe(t){return t&&h(t.schedule)}function Vt(t){return t[t.length-1]}function Yt(t){return h(Vt(t))?t.pop():void 0}function le(t){return pe(Vt(t))?t.pop():void 0}var me=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function de(t){return h(t==null?void 0:t.then)}function he(t){return h(t[B])}function ve(t){return Symbol.asyncIterator&&h(t==null?void 0:t[Symbol.asyncIterator])}function be(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Xr(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ye=Xr();function xe(t){return h(t==null?void 0:t[ye])}function ge(t){return Ft(this,arguments,function(){var e,o,n,i;return ee(this,function(a){switch(a.label){case 0:e=t.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,te(e.read())];case 3:return o=a.sent(),n=o.value,i=o.done,i?[4,te(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,te(n)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function _e(t){return h(t==null?void 0:t.getReader)}function E(t){if(t instanceof v)return t;if(t!=null){if(he(t))return Qr(t);if(me(t))return Zr(t);if(de(t))return eo(t);if(ve(t))return Jt(t);if(xe(t))return to(t);if(_e(t))return ro(t)}throw be(t)}function Qr(t){return new v(function(r){var e=t[B]();if(h(e.subscribe))return e.subscribe(r);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Zr(t){return new v(function(r){for(var e=0;e<t.length&&!r.closed;e++)r.next(t[e]);r.complete()})}function eo(t){return new v(function(r){t.then(function(e){r.closed||(r.next(e),r.complete())},function(e){return r.error(e)}).then(null,ie)})}function to(t){return new v(function(r){var e,o;try{for(var n=F(t),i=n.next();!i.done;i=n.next()){var a=i.value;if(r.next(a),r.closed)return}}catch(s){e={error:s}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(e)throw e.error}}r.complete()})}function Jt(t){return new v(function(r){oo(t,r).catch(function(e){return r.error(e)})})}function ro(t){return Jt(ge(t))}function oo(t,r){var e,o,n,i;return Dt(this,void 0,void 0,function(){var a,s;return ee(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),e=Rt(t),c.label=1;case 1:return[4,e.next()];case 2:if(o=c.sent(),!!o.done)return[3,4];if(a=o.value,r.next(a),r.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=c.sent(),n={error:s},[3,11];case 6:return c.trys.push([6,,9,10]),o&&!o.done&&(i=e.return)?[4,i.call(e)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(n)throw n.error;return[7];case 10:return[7];case 11:return r.complete(),[2]}})})}function A(t,r,e,o,n){o===void 0&&(o=0),n===void 0&&(n=!1);var i=r.schedule(function(){e(),n?t.add(this.schedule(null,o)):this.unsubscribe()},o);if(t.add(i),!n)return i}function Se(t,r){return r===void 0&&(r=0),y(function(e,o){e.subscribe(b(o,function(n){return A(o,t,function(){return o.next(n)},r)},function(){return A(o,t,function(){return o.complete()},r)},function(n){return A(o,t,function(){return o.error(n)},r)}))})}function Ee(t,r){return r===void 0&&(r=0),y(function(e,o){o.add(t.schedule(function(){return e.subscribe(o)},r))})}function Xt(t,r){return E(t).pipe(Ee(r),Se(r))}function Qt(t,r){return E(t).pipe(Ee(r),Se(r))}function Zt(t,r){return new v(function(e){var o=0;return r.schedule(function(){o===t.length?e.complete():(e.next(t[o++]),e.closed||this.schedule())})})}function er(t,r){return new v(function(e){var o;return A(e,r,function(){o=t[ye](),A(e,r,function(){var n,i,a;try{n=o.next(),i=n.value,a=n.done}catch(s){e.error(s);return}a?e.complete():e.next(i)},0,!0)}),function(){return h(o==null?void 0:o.return)&&o.return()}})}function we(t,r){if(!t)throw new Error("Iterable cannot be null");return new v(function(e){A(e,r,function(){var o=t[Symbol.asyncIterator]();A(e,r,function(){o.next().then(function(n){n.done?e.complete():e.next(n.value)})},0,!0)})})}function tr(t,r){return we(ge(t),r)}function rr(t,r){if(t!=null){if(he(t))return Xt(t,r);if(me(t))return Zt(t,r);if(de(t))return Qt(t,r);if(ve(t))return we(t,r);if(xe(t))return er(t,r);if(_e(t))return tr(t,r)}throw be(t)}function Ae(t,r){return r?rr(t,r):E(t)}function or(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var e=le(t);return Ae(t,e)}function $(t,r){var e=h(t)?t:function(){return t},o=function(n){return n.error(e())};return new v(r?function(n){return r.schedule(o,0,n)}:o)}var nr;(function(t){t.NEXT="N",t.ERROR="E",t.COMPLETE="C"})(nr||(nr={}));var Te=function(){function t(r,e,o){this.kind=r,this.value=e,this.error=o,this.hasValue=r==="N"}return t.prototype.observe=function(r){return qe(this,r)},t.prototype.do=function(r,e,o){var n=this,i=n.kind,a=n.value,s=n.error;return i==="N"?r==null?void 0:r(a):i==="E"?e==null?void 0:e(s):o==null?void 0:o()},t.prototype.accept=function(r,e,o){var n;return h((n=r)===null||n===void 0?void 0:n.next)?this.observe(r):this.do(r,e,o)},t.prototype.toObservable=function(){var r=this,e=r.kind,o=r.value,n=r.error,i=e==="N"?or(o):e==="E"?$(function(){return n}):e==="C"?L:0;if(!i)throw new TypeError("Unexpected notification kind "+e);return i},t.createNext=function(r){return new t("N",r)},t.createError=function(r){return new t("E",void 0,r)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t}();function qe(t,r){var e,o,n,i=t,a=i.kind,s=i.value,c=i.error;if(typeof a!="string")throw new TypeError('Invalid notification, missing "kind"');a==="N"?(e=r.next)===null||e===void 0||e.call(r,s):a==="E"?(o=r.error)===null||o===void 0||o.call(r,c):(n=r.complete)===null||n===void 0||n.call(r)}function ir(t){return t instanceof Date&&!isNaN(t)}function D(t,r){return y(function(e,o){var n=0;e.subscribe(b(o,function(i){o.next(t.call(r,i,n++))}))})}function ar(t,r,e,o,n,i,a,s){var c=[],u=0,f=0,m=!1,p=function(){m&&!c.length&&!u&&r.complete()},d=function(l){return u<o?_(l):c.push(l)},_=function(l){i&&r.next(l),u++;var S=!1;E(e(l,f++)).subscribe(b(r,function(T){n==null||n(T),i?d(T):r.next(T)},function(){S=!0},void 0,function(){if(S)try{u--;for(var T=function(){var W=c.shift();a?A(r,a,function(){return _(W)}):_(W)};c.length&&u<o;)T();p()}catch(W){r.error(W)}}))};return t.subscribe(b(r,d,function(){m=!0,p()})),function(){s==null||s()}}function K(t,r,e){return e===void 0&&(e=1/0),h(r)?K(function(o,n){return D(function(i,a){return r(o,i,n,a)})(E(t(o,n)))},e):(typeof r=="number"&&(e=r),y(function(o,n){return ar(o,n,t,e)}))}function sr(t){return t===void 0&&(t=1/0),K(ce,t)}function cr(){return sr(1)}function V(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return cr()(Ae(t,le(t)))}function Y(t,r,e){t===void 0&&(t=0),e===void 0&&(e=Kt);var o=-1;return r!=null&&(pe(r)?e=r:o=r),new v(function(n){var i=ir(t)?+t-e.now():t;i<0&&(i=0);var a=0;return e.schedule(function(){n.closed||(n.next(a++),0<=o?this.schedule(void 0,o):n.complete())},i)})}var no=Array.isArray;function ur(t){return t.length===1&&no(t[0])?t[0]:t}function $e(t,r){return y(function(e,o){var n=0;e.subscribe(b(o,function(i){return t.call(r,i,n++)&&o.next(i)}))})}function Ke(t,r,e){if(r==null&&(r=t,t=0),r<=0)return L;var o=r+t;return new v(e?function(n){var i=t;return e.schedule(function(){i<o?(n.next(i++),this.schedule()):n.complete()})}:function(n){for(var i=t;i<o&&!n.closed;)n.next(i++);n.complete()})}function Ve(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var e=Yt(t),o=ur(t);return o.length?new v(function(n){var i=o.map(function(){return[]}),a=o.map(function(){return!1});n.add(function(){i=a=null});for(var s=function(u){E(o[u]).subscribe(b(n,function(f){if(i[u].push(f),i.every(function(p){return p.length})){var m=i.map(function(p){return p.shift()});n.next(e?e.apply(void 0,C([],M(m))):m),i.some(function(p,d){return!p.length&&a[d]})&&n.complete()}},function(){a[u]=!0,!i[u].length&&n.complete()}))},c=0;!n.closed&&c<o.length;c++)s(c);return function(){i=a=null}}):L}function Ye(t){return t<=0?function(){return L}:y(function(r,e){var o=0;r.subscribe(b(e,function(n){++o<=t&&(e.next(n),t<=o&&e.complete())}))})}function fr(){return y(function(t,r){t.subscribe(b(r,G))})}function pr(t){return D(function(){return t})}function Je(t,r){return r?function(e){return V(r.pipe(Ye(1),fr()),e.pipe(Je(t)))}:K(function(e,o){return t(e,o).pipe(Ye(1),pr(e))})}function Xe(t,r){r===void 0&&(r=ze);var e=Y(t,r);return Je(function(){return e})}function Qe(){return y(function(t,r){t.subscribe(b(r,function(e){return qe(e,r)}))})}function Ze(){return y(function(t,r){t.subscribe(b(r,function(e){r.next(Te.createNext(e))},function(){r.next(Te.createComplete()),r.complete()},function(e){r.next(Te.createError(e)),r.complete()}))})}function et(t){return y(function(r,e){var o,n=!1,i,a=function(){o=r.subscribe(b(e,void 0,void 0,function(s){i||(i=new w,t(i).subscribe(b(e,function(){return o?a():n=!0}))),i&&i.next(s)})),n&&(o.unsubscribe(),o=null,n=!1,a())};a()})}function tt(t,r){return y(function(e,o){var n=null,i=0,a=!1,s=function(){return a&&!n&&o.complete()};e.subscribe(b(o,function(c){n==null||n.unsubscribe();var u=0,f=i++;E(t(c,f)).subscribe(n=b(o,function(m){return o.next(r?r(c,m,f,u++):m)},function(){n=null,s()}))},function(){a=!0,s()}))})}var Me=class{constructor(r,e,o){this.subscriptions=[];this.channel=r,this.params=e,this.socket=o,this.subject=new w,this.connectedSubject=new w,this.presenceSubject=new w}get isActive(){return this.connectedSubject.observed}join(){if(this.connectedSubject.observed)return this;let e=this.init().subscribe(o=>{this.connectedSubject.next(!0),o.action==="PRESENCE"?this.presenceSubject.next(o.payload.presence):o.action==="MESSAGE"?this.subject.next(o):o.event==="KICKED_FROM_CHANNEL"&&this.leave()});return this.subscriptions.push(e),this}leave(){this.connectedSubject.next(!1),this.presenceSubject.complete(),this.subscriptions.forEach(r=>r.unsubscribe()),this.subscriptions=[],this.subject.complete()}onPresenceUpdate(r){let e=this.presenceSubject.subscribe(r);return this.subscriptions.push(e),e}onMessage(r){let e=this.subject.pipe($e(o=>o.action==="MESSAGE")).subscribe(o=>r(o.event,o.payload));return this.subscriptions.push(e),e}broadcast(r,e){let o={channelName:this.channel,payload:e,event:r,action:"BROADCAST"};this.socket.next(o)}broadcastFrom(r,e){let o={channelName:this.channel,payload:e,event:r,action:"BROADCAST_FROM"};this.socket.next(o)}updatePresence(r){this.socket.next({action:"UPDATE_PRESENCE",channelName:this.channel,event:"PRESENCE",payload:r})}sendMessage(r,e,o){let n=Array.isArray(o)?o:[o],i={channelName:this.channel,payload:e,event:r,addresses:n,action:"SEND_MESSAGE_TO_USER"};this.socket.next(i)}onConnectionChange(r){let e=this.connectedSubject.subscribe(r);return this.subscriptions.push(e),e}init(){return this.socket.multiplex(()=>({action:"JOIN_CHANNEL",channelName:this.channel,event:"JOIN_CHANNEL",payload:this.params}),()=>({action:"LEAVE_CHANNEL",channelName:this.channel,event:"LEAVE_CHANNEL",payload:this.params}),e=>e.channelName===this.channel)}};var Ce=class{constructor(r,e){this.socketState="CLOSED";this._retryStrategy=(r,e)=>Ue(et(o=>{let n=Ve(Ke(1,r),o).pipe(D(([a,s])=>a),D(a=>a*a),tt(a=>Y(a*e))),i=$(new Error("Could not connect to server")).pipe(Ze(),Xe(1e3),Qe());return V(n,i)}));let o;try{o=new URL(r)}catch(a){o=new URL(window.location.toString()),o.pathname=r}let n=new URLSearchParams(e);o.search=n.toString();let i=o.protocol==="https:"?"wss:":"ws:";o.protocol!=="wss:"&&o.protocol!=="ws:"&&(o.protocol=i),this.address=o,this.channels=new Map}connect(){if(this.socketState!=="CLOSED")return;this.socketState="CONNECTING";let r=Be({url:this.address.toString(),openObserver:{next:()=>{this.socketState="OPEN"}},closeObserver:{next:()=>{this.socketState="CLOSED"}},closingObserver:{next:()=>{this.socketState="CLOSING"}}});return this.socket=r,this.subscription=r.pipe(this._retryStrategy(100,1e3)).subscribe(),this}getState(){return this.socketState}createChannel(r,e){let o=this.channels.get(r);if(o)return o;let n=new Me(r,e||{},this.socket);return this.channels.set(r,n),n}onMessage(r){var e;(e=this.socket)==null||e.subscribe(o=>{o.event&&r(o.event,o.payload)})}disconnect(){var r,e,o;(r=this.socket)==null||r.complete(),(e=this.socket)==null||e.unsubscribe(),(o=this.subscription)==null||o.unsubscribe(),this.socket=void 0,this.channels=new Map}};var rt=(t,r,e,o)=>{let n=document.createElement("div");n.innerHTML=r.trim();let i=n.querySelector("#"+e),a=t.querySelector("#"+e);i&&a&&i.replaceWith(a.cloneNode(!0));let s=n.firstElementChild;Oe(t,s),o&&o.pageTitle&&(document.title=o.pageTitle)},Oe=(t,r)=>{if(t instanceof Text&&r instanceof Text&&t.textContent!==r.textContent){t.replaceWith(r.cloneNode(!0));return}if(t instanceof Text&&r instanceof Element){t.replaceWith(r.cloneNode(!0));return}if(t instanceof Element&&r instanceof Text){t.replaceWith(r.cloneNode(!0));return}if(t.tagName!==r.tagName){t.replaceWith(r.cloneNode(!0));return}for(let o in r.attributes){let n=r.attributes[o];n&&n.name&&n.value&&(!t.hasAttribute(n.name)||t.getAttribute(n.name)!==n.value)&&t.setAttribute(n.name,n.value)}for(let o in t.attributes){let n=t.attributes[o];n&&n.name&&n.value&&(r.hasAttribute(n.name)?r.hasAttribute(n.name)&&r.getAttribute(n.name)!==n.value&&t.setAttribute(n.name,r.getAttribute(n.name)):t.removeAttribute(n.name))}let e=Math.max(t.childNodes.length,r.childNodes.length);for(let o=0;o<e;o++){let n=t.childNodes[o],i=r.childNodes[o];if(n&&i)Oe(n,i);else{if(n)return io(t,o);i&&t.appendChild(i.cloneNode(!0))}}},io=(t,r)=>{let e=t.childNodes;for(let o=e.length-1;o>=r;o--)e[o].remove()};var x=(t,r,e)=>{let o=new CustomEvent(t,{detail:r,bubbles:!0,cancelable:!0});e?e.dispatchEvent(o):window.dispatchEvent(o)},J=(t,r,e,o)=>{let n=r.closest("[pond-router]"),i=null;if(o&&(i=o.target.value),n){let a=n.getAttribute("pond-router"),s=r.getAttribute(e),c=r.getAttribute("pond-data-id");a&&s&&ot(t,a,{type:s,dataId:c,value:i})}},ot=(t,r,e)=>{t.broadcastFrom(`event/${r}`,e)},lr=(t,r,e)=>{t.broadcastFrom(r,e)};var mr=async t=>{x("navigate-start",{location:t,shallow:!1}),history.pushState(null,"",t),await dr(t),x("navigate-end",{location:t,shallow:!1})};window.addEventListener("popstate",async()=>{x("navigate-start",{location:location.pathname,shallow:!1}),await dr(location.pathname),x("navigate-end",{location:location.pathname,shallow:!1})});var dr=async t=>{let r={"Content-Type":"text/html",Accept:"text/html","x-csrf-token":window.token,"x-router-request":"true",method:"GET"},e=await fetch(t,{headers:r}),o=e.headers;if(o.has("x-router-action")){let n=o.get("x-router-action");if(n){let i=o.get("x-router-path"),a=o.get("x-page-title"),s=o.get("x-flash-message");await nt(i,n,a,s)}}else{let n=o.get("x-router-container"),i=o.get("x-page-title"),a=o.get("x-flash-message"),s=await e.text();ao(n,s,i,a)}},hr=t=>{t.delegateEvent("a","click",async(r,e)=>{e.preventDefault();let n=r.href;await mr(n)})},nt=async(t,r,e,o)=>{switch(r){case"replace":x("navigate-start",{location:t,shallow:!1}),history.replaceState(null,"",t),x("navigate-end",{location:t,shallow:!1});break;case"redirect":await mr(t);break}e&&(document.title=e),o&&x("flash-message",{flashMessage:o})},ao=(t,r,e,o)=>{let n=document.querySelector(t);if(n){let i=document.createElement("div");i.innerHTML=r;let a=i.firstElementChild,s=a.getAttribute("pond-router");s&&n.setAttribute("pond-router",s),Oe(n,a),e&&(document.title=e),o&&x("flash-message",{flashMessage:o})}};var it=(t,r)=>{if(t===void 0)return r;if(r===void 0)return t;for(let e in r)r[e]instanceof Object?t[e]=it(t[e],r[e]):r[e]===null?delete t[e]:t[e]=r[e];return t instanceof Array?t.filter(e=>e!=null):t};var br={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},so=new RegExp(Object.keys(br).join("|"),"g");function ke(t,r){return r==null&&(r=","),t.length<=0?new P([""],[]):new P(["",...Array(t.length-1).fill(r),""],t)}function vr(t){return t==null?"":t instanceof P?t.toString():Array.isArray(t)?ke(t,"").toString():String(t).replace(so,r=>br[r])}var P=class{constructor(r,e){this.statics=r,this.dynamics=e}toString(){let r=this.statics[0];for(let e=0;e<this.dynamics.length;e++)this.dynamics[e]instanceof P?r+=this.dynamics[e].toString()+this.statics[e+1]:Array.isArray(this.dynamics[e])?r+=ke(this.dynamics[e],"").toString()+this.statics[e+1]:typeof this.dynamics[e]=="object"?r+=this.parsedHtmlToString(this.dynamics[e])+this.statics[e+1]:r+=vr(this.dynamics[e])+this.statics[e+1];return r}getParts(){let r={s:this.statics};for(let e=0;e<this.dynamics.length;e++)this.dynamics[e]instanceof P?r[e]=this.dynamics[e].getParts():Array.isArray(this.dynamics[e])?r[e]=ke(this.dynamics[e],"").getParts():this.dynamics[e]===void 0?r[e]=null:r[e]=this.dynamics[e];return r}parsedHtmlToString(r){var n;let e=r,o="";if(Array.isArray(e))return ke(e,"").toString();if(((n=e==null?void 0:e.s)==null?void 0:n.length)>0){let i=e.s.filter(a=>a!=null);o=e.s[0];for(let a=0;a<i.length-1;a++)typeof e[a]=="object"?o+=this.parsedHtmlToString(r[a])+e.s[a+1]:o+=vr(r[a])+e.s[a+1]}return o}reconstruct(r){let e=it(this.getParts(),r);return this.parse(e)}parse(r){let e=r,o=e.s||[""];delete e.s;let n=Object.values(e).filter(i=>i!=null);return new P(o,n)}};function yr(t,...r){return new P(t,r)}var xr=(t,r)=>{let e={},o={},n=s=>{let c=s.getAttribute("pond-router");c&&!e[c]&&(e[c]=t.onMessage(async(u,f)=>{if(f.path===c){if(u==="rendered"){let p=yr``.parse(f.rendered);o[c]=p;let d=p.toString();rt(s,d,c,f.headers)}if(u==="updated"&&o[c]){let p=o[c].reconstruct(f.rendered);o[c]=p;let d=p.toString();rt(s,d,c,f.headers)}f.headers&&(f.headers.pageTitle?document.title=f.headers.pageTitle:f.headers.flashMessage&&x("flash-message",{flashMessage:f.headers.flashMessage}))}}),t.broadcastFrom(`mount/${c}`,{}))},i=(s,c)=>{let u=c;u&&e[u]&&(t.broadcastFrom(`unmount/${u}`,{}),e[u].unsubscribe(),delete e[u],delete o[u])},a=(s,c)=>{let u=s.getAttribute("pond-router");c&&u?c!==u?(i(s,c),n(s)):e[u]&&t.broadcastFrom(`update/${u}`,{}):c&&e[c]?i(s,c):u&&!e[u]&&n(s)};r.watch("[pond-router]",{onAdd:n,onRemove:i,onUpdated:a})},gr=t=>{t.onMessage(async(r,e)=>{if(r==="router"){let{action:o,path:n}=e;await nt(n,o)}else r==="emit"&&x(e.event,e.data)})};var Pe=class{constructor(){this._modifiers={};let r=new MutationObserver(e=>{for(let o=0;o<e.length;o++){let n=e[o];switch(n.type){case"childList":for(let s=0;s<n.removedNodes.length;s++){let c=n.removedNodes[s];if(c instanceof HTMLElement){let u=c;for(let f in this._modifiers)u.matches(f)&&this._modifiers[f].forEach(p=>{p.onRemove&&p.onRemove(u,null)})}}for(let s=0;s<n.addedNodes.length;s++){let c=n.addedNodes[s];if(c instanceof HTMLElement){let u=c;this._addNewElement(u)}}break;case"attributes":let i=n.target,a=`[${n.attributeName}]`;for(let s in this._modifiers)if(a===s||i.matches(s))if(n.oldValue===null)this._modifiers[s].forEach(u=>{u.onAdd&&u.onAdd(i,null)});else{let c=this._modifiers[s],u=i.getAttribute(n.attributeName);c.forEach(f=>{u?f.onUpdated&&f.onUpdated(i,n.oldValue):f.onRemove&&f.onRemove(i,n.oldValue)})}}}});r.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0}),this._observer=r}watch(r,e){let o=document.querySelectorAll(r);for(let i=0;i<o.length;i++){let a=o[i];e.onAdd&&e.onAdd(a,null)}let n=this._modifiers[r]||[];n.push(e),this._modifiers[r]=n}unwatch(r){delete this._modifiers[r]}isWatching(r){return!!this._modifiers[r]}addEventListener(r,e,o){this.watch(r,{onAdd:n=>{n.addEventListener(e,i=>{o(n,i)},{capture:!0})},onRemove:n=>{n.removeEventListener(e,i=>{o(n,i)},{capture:!0})}})}delegateEvent(r,e,o){document.body.addEventListener(e,n=>{let i=n.target;if(i.tagName.toLowerCase()===r.toLowerCase())return o(i,n);let a=i.parentElement;if(a&&a.tagName.toLowerCase()===r.toLowerCase())return o(a,n);let s=i.firstElementChild;if(s&&s.tagName.toLowerCase()===r.toLowerCase())return o(s,n)})}shutdown(){for(let r in this._modifiers)this.unwatch(r);this._observer.disconnect()}_addNewElement(r){for(let e in this._modifiers)r.matches(e)&&this._modifiers[e].forEach(n=>{n.onAdd&&n.onAdd(r,null)});for(let e=0;e<r.children.length;e++)this._addNewElement(r.children[e])}};var co=t=>{t("[pond-click]","click",()=>({value:null}))},uo=t=>{t("[pond-mouseenter]","mouseenter",()=>({value:null}))},fo=t=>{t("[pond-mouseleave]","mouseleave",()=>({value:null}))},po=t=>{t("[pond-mousemove]","mousemove",()=>({value:null}))},lo=t=>{t("[pond-mousedown]","mousedown",()=>({value:null}))},mo=t=>{t("[pond-mouseup]","mouseup",()=>({value:null}))},ho=t=>{t("[pond-double-click]","dblclick",()=>({value:null}))},vo=t=>{t("[pond-drag-start]","dragstart",(r,e)=>{let o=e.getBoundingClientRect(),n={top:o.top,left:o.left,width:o.width,height:o.height};return{value:null,dragData:n}})},bo=t=>{t("[pond-drag-end]","dragend",(r,e)=>{let o=e.getBoundingClientRect(),n={top:o.top,left:o.left,width:o.width,height:o.height};return{value:null,dragData:n}})},yo=t=>{t("[pond-drag-over]","dragover",(r,e)=>{let o=e.getBoundingClientRect(),n={top:o.top,left:o.left,width:o.width,height:o.height};return{value:null,dragData:n}})},xo=t=>{t("[pond-drag-enter]","dragenter",(r,e)=>{let o=e.getBoundingClientRect(),n={top:o.top,left:o.left,width:o.width,height:o.height};return{value:null,dragData:n}})},go=t=>{t("[pond-drag-leave]","dragleave",(r,e)=>{let o=e.getBoundingClientRect(),n={top:o.top,left:o.left,width:o.width,height:o.height};return{value:null,dragData:n}})},_o=t=>{t("[pond-drop]","drop",(r,e)=>{let o=e.getBoundingClientRect(),n={top:o.top,left:o.left,width:o.width,height:o.height};return{value:null,dragData:n}})},_r=t=>{co(t),uo(t),fo(t),po(t),lo(t),mo(t),ho(t),vo(t),bo(t),yo(t),xo(t),go(t),_o(t)};var So=(t,r)=>{r.addEventListener("[pond-keyup]","keyup",(e,o)=>{J(t,e,"pond-keyup",o)})},Eo=(t,r)=>{r.addEventListener("[pond-keydown]","keydown",(e,o)=>{J(t,e,"pond-keydown",o)})},wo=(t,r)=>{r.addEventListener("[pond-keypress]","keypress",(e,o)=>{J(t,e,"pond-keypress",o)})},Ao=(t,r)=>{r.addEventListener("[pond-change]","change",(e,o)=>{J(t,e,"pond-change",o)})},To=(t,r)=>{r.addEventListener("[pond-window-keyup]","keyup",(e,o)=>{let n=e.closest("[pond-router]"),i=o.key;if(n){let a=n.getAttribute("pond-router"),s=e.getAttribute("pond-window-keyup");a&&s&&i&&t.broadcastFrom(`event/${a}`,{type:s,key:i})}})},Mo=(t,r)=>{r.addEventListener("[pond-window-keydown]","keydown",(e,o)=>{let n=e.closest("[pond-router]"),i=o.key;if(n){let a=n.getAttribute("pond-router"),s=e.getAttribute("pond-window-keydown");a&&s&&i&&t.broadcastFrom(`event/${a}`,{type:s,key:i})}})},Co=(t,r)=>{r.addEventListener("[pond-window-keypress]","keypress",(e,o)=>{let n=e.closest("[pond-router]"),i=o.key;if(n){let a=n.getAttribute("pond-router"),s=e.getAttribute("pond-window-keypress");a&&s&&i&&t.broadcastFrom(`event/${a}`,{type:s,key:i})}})},Sr=(t,r)=>{So(t,r),Eo(t,r),wo(t,r),Ao(t,r),To(t,r),Mo(t,r),Co(t,r)};var Oo=(t,r)=>{r.addEventListener("[pond-focus]","focus",e=>{let o=e.closest("[pond-router]");if(o){let n=o.getAttribute("pond-router"),i=e.getAttribute("pond-focus"),a=e.getAttribute("pond-data-id");n&&i&&t.broadcastFrom(`event/${n}`,{type:i,dataId:a})}})},ko=(t,r)=>{r.addEventListener("[pond-blur]","blur",e=>{let o=e.closest("[pond-router]");if(o){let n=o.getAttribute("pond-router"),i=e.getAttribute("pond-blur"),a=e.getAttribute("pond-data-id");n&&i&&t.broadcastFrom(`event/${n}`,{type:i,dataId:a})}})},Po=(t,r)=>{r.addEventListener("[pond-change]","change",e=>{let o=e.closest("[pond-router]");if(o){let n=o.getAttribute("pond-router"),i=e.getAttribute("pond-change"),a=e.getAttribute("pond-data-id");n&&i&&t.broadcastFrom(`event/${n}`,{type:i,dataId:a})}})},Lo=(t,r)=>{r.addEventListener("[pond-input]","input",e=>{let o=e.closest("[pond-router]");if(o){let n=o.getAttribute("pond-router"),i=e.getAttribute("pond-input"),a=e.getAttribute("pond-data-id");n&&i&&t.broadcastFrom(`event/${n}`,{type:i,dataId:a})}})},Do=(t,r)=>{r.addEventListener("[pond-submit]","submit",(e,o)=>{o.preventDefault();let n=e.closest("[pond-router]");if(n){let i=n.getAttribute("pond-router"),a=e.getAttribute("pond-submit"),s=e.getAttribute("pond-data-id");i&&a&&t.broadcastFrom(`event/${i}`,{type:a,dataId:s})}})},Er=(t,r)=>{Oo(t,r),ko(t,r),Po(t,r),Lo(t,r),Do(t,r)};var wr=(t,r,e,o)=>{let n=new XMLHttpRequest;return n.open("POST",o),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("x-csrf-token",e),n.setRequestHeader("x-router-request","true"),n.setRequestHeader("x-router-path",t),n.setRequestHeader("x-router-event",r),n.onreadystatechange=()=>{if(n.readyState===4&&n.status===200){let i=JSON.parse(n.responseText);x("pond-upload-success",i)}else x("pond-upload-error",n.responseText)},n.onloadstart=()=>x("pond-upload-start",{}),n.onloadend=()=>x("pond-upload-end",{}),n.onprogress=i=>{i.lengthComputable&&x("pond-upload-progress",{progress:Math.round(i.loaded/i.total*100)})},n},Fo=(t,r,e,o,n,i)=>{let a=i.onMessage((s,c)=>{if(s==="pondUploadToken"&&c.token&&c.identifier===r&&c.uploadPath){a.unsubscribe();let u=wr(n,o,c.token,c.uploadPath),f=new FormData;f.append(e,t,t.name),u.send(f)}else s==="pondUploadError"&&c.identifier===r&&(a.unsubscribe(),x("pond-upload-error",c.error))});return a},Ro=t=>{let r=[];if(!t)return r;for(let e=0;e<t.length;e++)r.push({path:`/${t[e].name}`,file:t[e]});return r},Io=t=>new Promise(async r=>{let e=[];for(let i=0;i<t.length;i++){let a=t[i].webkitGetAsEntry();a&&e.push(a)}let o=e.map(i=>Ar(i)),n=await Promise.all(o);r(n.flat())}),Ar=(t,r="/")=>new Promise(e=>{if(t.isFile)t.file(n=>{let i=`${r}${n.name}`;e([{path:i,file:n}])});else if(t.isDirectory){let o=t,n=o.createReader(),i=[];n.readEntries(async a=>{for(let s=0;s<a.length;s++){let c=a[s],u=`${r}${o.name}/`,f=await Ar(c,u);i.push(...f)}e(i)})}}),Tr=async(t,r,e,o)=>{let n=[],i=[],a=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);t instanceof DataTransferItemList?n=await Io(t):t instanceof FileList&&(n=Ro(t));let s=r.onMessage((u,f)=>{if(u==="pondUploadToken"&&f.token&&f.identifier===a&&f.uploadPath){s.unsubscribe(),i.forEach(d=>d.unsubscribe());let m=wr(e,o,f.token,f.uploadPath),p=new FormData;n.forEach(d=>p.append(d.path,d.file,d.file.name)),m.send(p)}else u==="pondUploadError"&&f.identifier===a&&(s.unsubscribe(),i.forEach(m=>m.unsubscribe()),x("pond-upload-error",f.error))});return{metaData:n.map(u=>{let f=Mr(u.file)[0],m=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return i.push(Fo(u.file,m,u.path,o,e,r)),{name:f.name,size:f.size,type:f.type,identifier:m,lastModified:f.lastModified,lastModifiedDate:f.lastModifiedDate}}),longRandom:a}},Mr=t=>{let r=[];if(t instanceof FileList)for(let e=0;e<t.length;e++)r.push({name:t[e].name,size:t[e].size,type:t[e].type,lastModified:t[e].lastModified,lastModifiedDate:new Date(t[e].lastModified)});else t instanceof File&&r.push({name:t.name,size:t.size,type:t.type,lastModified:t.lastModified,lastModifiedDate:new Date(t.lastModified)});return r},No=t=>{t("[pond-file]","change",(r,e)=>{let n=e.files;if(n){let i=Mr(n);return{value:null,files:i}}return null})},Wo=(t,r)=>{r("[pond-upload]","submit",async(e,o,n,i)=>{e.preventDefault();let s=o.querySelector('input[type="file"]').files;if(s){let{metaData:c,longRandom:u}=await Tr(s,t,n,i);return{value:null,files:c,event:`${n}/upload/token`,metadata:{identifier:u,type:"UPLOAD_REQUEST"}}}return null})},Ho=(t,r)=>{r("[pond-drop-upload]","drop",async(e,o,n,i)=>{var s;let a=(s=e.dataTransfer)==null?void 0:s.items;if(a){let{metaData:c,longRandom:u}=await Tr(a,t,n,i);return{value:null,files:c,event:`${n}/upload/token`,metadata:{identifier:u,type:"UPLOAD_REQUEST"}}}return null})},Cr=(t,r)=>{No(r),Wo(t,r),Ho(t,r)};var Uo=async(t,r,e,o,n)=>{n.preventDefault();let i=r.replace("[","").replace("]",""),a=o.closest("[pond-router]"),s=o.getAttribute(i),c=o.getAttribute("pond-data-id");if(a&&s){let u=a.getAttribute("pond-router");if(u){let f=await e(n,o,u,s);f&&(f.event?lr(t,f.event,Fe(De({},f),{dataId:c,type:s})):ot(t,u,Fe(De({},f),{dataId:c,type:s})))}}},Or=(t,r)=>(e,o,n)=>{r.addEventListener(e,o,async(i,a)=>{await Uo(t,e,n,i,a)})};var kr=()=>{let t=new Ce("/live");t.connect();let r=!1;t.onMessage((e,o)=>{if(e==="token"&&!r){window.token=o.csrfToken,r=!0;let n=new Pe,i=t.createChannel(`/${o.nanoId}`,{clientId:o.csrfToken});i.join();let a=!1;i.onConnectionChange(s=>{if(s){let c=Or(i,n);xr(i,n),_r(c),Sr(i,n),Er(i,n),hr(n),gr(i),Cr(i,c),a||(a=!0,x("pondReady",i))}})}})};window.addEventListener("load",()=>{kr()});})();
